                                                                                 local Players=game:   
                                                                        GetService("Players");local Workspace=game:     
                                                                    GetService("Workspace");local RunService=game:GetService(     
                                                                "RunService");local TweenService=game:GetService("TweenService");local  
                                                            ReplicatedStorage=game:GetService("ReplicatedStorage");local UserInputService 
                                                          =game:GetService("UserInputService");local CoreGui=game:GetService("CoreGui");    
                                                        local HttpService=game:GetService("HttpService");local VirtualUser=game:GetService(   
                                                      "VirtualUser");local player=Players.LocalPlayer;local character=player.Character or       
                                                    player.CharacterAdded:Wait() ;local humanoid=character:WaitForChild("Humanoid");local         
                                                  humanoidRootPart=character:WaitForChild("HumanoidRootPart");local GatherQiEvent=ReplicatedStorage 
                                                  :WaitForChild("Remotes"):WaitForChild("GatherQi");local BreakthroughEvent=ReplicatedStorage:        
                                                WaitForChild("Remotes"):WaitForChild("Breakthrough");local CraftPillEvent=ReplicatedStorage:            
                                                WaitForChild("Remotes"):WaitForChild("CraftPill");local CONFIG={FLY_HEIGHT=750,NORMAL_HEIGHT_OFFSET=5,    
                                              FLY_SPEED=120,MOVE_TIMEOUT=35,MOVE_DISTANCE_THRESHOLD=4,HEIGHT_TWEEN_TIME=0.7,HERBS_FOLDER_NAME="Herbs",      
                                              COLLECT_TIMEOUT=15,MAX_RETRY_ATTEMPTS=3,FLIGHT_STABILIZATION=0.95,TIMEOUT_COOLDOWN=30,MAX_PRIORITY_HERBS=6,   
                                            UI_UPDATE_INTERVAL=1,BREAKTHROUGH_INTERVAL=3,BLACKLIST_HERBS={"Herbicide"},PILL_TYPES={"Blood Qi","Qi Spirit",    
                                            "Qi Gathering","Bottleneck Breaking","Extreme Yin","Extreme Yang","Mirror Heart","Extreme Yin Yang","Soul Bead"},   
                                          UI_SCALE={MAIN_FRAME_WIDTH=550,MAIN_FRAME_HEIGHT=400,TAB_BUTTON_WIDTH=120,TAB_BUTTON_HEIGHT=40,PRIORITY_FRAME_WIDTH=450 
                                          ,PRIORITY_FRAME_HEIGHT=500,TITLE_TEXT_SIZE=18,SUBTITLE_TEXT_SIZE=14,BODY_TEXT_SIZE=12,SMALL_TEXT_SIZE=10,BUTTON_HEIGHT=32 
                                          ,BUTTON_TEXT_SIZE=14,HERB_ITEM_HEIGHT=35,PADDING_SMALL=8,PADDING_MEDIUM=12,PADDING_LARGE=16}};local HerbState={isRunning=   
                                          false,currentHerb=nil,IsFlying=false,FlightBodyVelocity=nil,FlightBodyGyro=nil,FlightConnection=nil,collectedHerbs={},      
                                        timeoutHerbs={},retryAttempts=0,OriginalGravity=workspace.Gravity,currentTimeoutCount=0,herbAgeCache={},failCount=0,            
                                        priorityHerbs={},availableHerbTypes={},isPriorityUIOpen=false,        --[[==============================]]mainLoopCoroutine=nil,  
                                        collectHerbs=true,collectAuras=true,targetMode="both",      --[[============================================]]quickPickEnabled=   
                                        false,autoHarvestEnabled=false,autoHarvestConnection=   --[[======================================================]]nil,            
                                      autoHarvestLastCollectTime=0,                         --[[==========================================================]]                  
                                      autoHarvestCollectInterval=0.1,                     --[[==============================================================]]                
                                      autoHarvestMaxDistance=15,modifiedHerbs={},         --[[================================================================]]                
                                      herbsFolderListener=nil,quickPickConnection=nil,    --[[==================================================================]]              
                                      lastTargetTime=0,collisionEnabled=false,            --[[==================================================================]]                  
                                    auraAutoCollectEnabled=false};local                   --[[====================================================================]]              
                    AuraAutoCollectState={enabled=false,connection=nil,lastCollectTime=0, --[[====================================================================]]collectInterval 
              =0.5,maxDistance=15};local CollisionState={isCollisionDisabled=false,       --[[======================================================================]]              
            processedParts={},partConnections={},collisionListener=nil,                   --[[======================================================================]]              
          collisionReapplyTimer=nil,originalCollisionStates={}};local AuraState={         --[[======================================================================]]currentAura=  
        nil,aurasFolderName="Auras"};local CultState={isCultivating=false,                --[[======================================================================]]              
        isAutoBreakthrough=false,breakthroughConnection=nil,lastBreakthroughTime=0};local --[[======================================================================]] PillState={  
      isCrafting=false,currentPillType="Qi Spirit",craftCount=1,craftInterval=3,          --[[======================================================================]]              
      craftConnection=nil,isPillUIOpen=false};local function disableAllCollisionInMap()     --[[==================================================================]]local mapFolder 
      =Workspace:FindFirstChild("Map");if  not mapFolder then print(                        --[[================================================================]]                  
    "[碰撞修改] 错误: 未找到 Map 文件夹");return false;end print("[碰撞修改] 开始修改 Map 文件夹中的所有碰撞属性...");     --[[==============================================================]]local             
    processedCount=0;CollisionState.originalCollisionStates={};local function processFolder(  --[[==========================================================]]folder) if  not     
    folder then return;end for _,item in ipairs(folder:GetChildren()) do if item:IsA("BasePart" --[[====================================================]]) then CollisionState.  
    originalCollisionStates[item]=item.CanCollide;item.CanCollide=false;processedCount=           --[[==============================================]]processedCount + 1 ;local 
     connection=item:GetPropertyChangedSignal("CanCollide"):Connect(function() if (item.CanCollide==  --[[====================================]]true) then item.CanCollide=   
    false;end end);table.insert(CollisionState.partConnections,connection);if ((processedCount%100)==0)   --[[========================]]then print(string.format(             
    "[碰撞修改] 已处理 %d 个对象...",processedCount));end end if (item:IsA("Folder") or item:IsA("Model") or item:IsA("BaseScript")) then processFolder(item);end end end             
  processFolder(mapFolder);print(string.format("[碰撞修改] 完成！已处理 %d 个对象的 CanCollide 属性设置为 false",processedCount));if  not CollisionState.collisionListener then              
  CollisionState.collisionListener=mapFolder.DescendantAdded:Connect(function(descendant) if descendant:IsA("BasePart") then task.wait(0.5);CollisionState.             
  originalCollisionStates[descendant]=descendant.CanCollide;descendant.CanCollide=false;local connection=descendant:GetPropertyChangedSignal("CanCollide"):Connect(       
  function() if (descendant.CanCollide==true) then descendant.CanCollide=false;end end);table.insert(CollisionState.partConnections,connection);end end);end              
  CollisionState.isCollisionDisabled=true;print("[碰撞修改] 碰撞禁用状态已记录");return true;end local function enableAllCollisionInMap() print("[碰撞恢复] 开始恢复地图碰撞...");if               
  CollisionState.collisionListener then CollisionState.collisionListener:Disconnect();CollisionState.collisionListener=nil;end if CollisionState.collisionReapplyTimer    
  then CollisionState.collisionReapplyTimer:Disconnect();CollisionState.collisionReapplyTimer=nil;end for _,connection in ipairs(CollisionState.partConnections) do       
  connection:Disconnect();end local restoredCount=0;for part,originalState in pairs(CollisionState.originalCollisionStates) do if (part and part.Parent) then part.       
  CanCollide=originalState;restoredCount=restoredCount + 1 ;end end CollisionState.processedParts={};CollisionState.partConnections={};CollisionState.                    
  originalCollisionStates={};CollisionState.isCollisionDisabled=false;print(string.format("[碰撞恢复] 已恢复 %d 个对象的碰撞属性",restoredCount));return true;end local AntiAFKState={   
  LastSignalTime=0,SignalInterval=55,Connections={},IsRunning=false,LastLogTime=0,LastErrorTime=0,LastVirtualUserTime=0,VirtualUserInterval=120,VirtualUserEnabled=true,  
  LastVirtualUserLogTime=0,HeartbeatConnection=nil,InitAttempts=0,MaxInitAttempts=3,IsInitializing=false};local function getInteractEvent() local success,result=pcall(     
  function() local ReplicatedStorage=game:GetService("ReplicatedStorage");local Remotes=ReplicatedStorage:WaitForChild("Remotes");return Remotes:WaitForChild("Interact");  
  end);if (success and result) then return result;end return nil;end local function sendAntiAFKSignal() local success,result=pcall(function() local InteractEvent=          
  getInteractEvent();if InteractEvent then InteractEvent:FireServer("Active");return true;end return false;end);if (success and result) then AntiAFKState.LastSignalTime=   
  tick();return true;end return false;end local function executeVirtualUserAntiAFK() local currentTime=tick();if ((currentTime-AntiAFKState.LastVirtualUserTime)<           
  AntiAFKState.VirtualUserInterval) then return;end task.spawn(function() local success,err=pcall(function() if ( not VirtualUser or (typeof(VirtualUser)~="Instance"))     
  then return;end if  not workspace.CurrentCamera then return;end VirtualUser:Button2Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame);task.wait(0.05);VirtualUser:     
  Button2Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame);end);if success then AntiAFKState.LastVirtualUserTime=currentTime;if ((currentTime-AntiAFKState.               
  LastVirtualUserLogTime)>=600) then print("[VirtualUser防AFK] 防AFK操作已执行 - "   .. os.date("%H:%M:%S") );AntiAFKState.LastVirtualUserLogTime=currentTime;end elseif ((        
  currentTime-AntiAFKState.LastErrorTime)>=300) then print("[VirtualUser防AFK] 执行防AFK操作失败");AntiAFKState.LastErrorTime=currentTime;end end);end local function               
  checkAndSendSignal() if  not AntiAFKState.IsRunning then return;end local currentTime=tick();local timeSinceLastSignal=currentTime-AntiAFKState.LastSignalTime ;if (      
  timeSinceLastSignal>=AntiAFKState.SignalInterval) then local success=sendAntiAFKSignal();if (success and ((currentTime-(AntiAFKState.LastLogTime or 0))>=300)) then print 
  ("[防AFK] 发送活动信号 - "   .. os.date("%H:%M:%S") );AntiAFKState.LastLogTime=currentTime;elseif ( not success and ((currentTime-(AntiAFKState.LastErrorTime or 0))>=60)) then  
  print("[防AFK] 发送信号失败");AntiAFKState.LastErrorTime=currentTime;end end if AntiAFKState.VirtualUserEnabled then executeVirtualUserAntiAFK();end end local function        
  onInputChanged() if AntiAFKState.IsRunning then checkAndSendSignal();end end local function onInputBegan() if AntiAFKState.IsRunning then checkAndSendSignal();end end  
  local function setupAntiAFK() if AntiAFKState.IsInitializing then print("[防AFK] 防AFK系统正在初始化中，跳过...");return true;end if AntiAFKState.IsRunning then print(              
    "[防AFK] 防AFK系统已在运行中，无需重启");return true;end if (AntiAFKState.InitAttempts>=AntiAFKState.MaxInitAttempts) then print("[防AFK] 已达到最大初始化尝试次数 ("   .. AntiAFKState.         
    MaxInitAttempts   .. ")，暂停启动" );return false;end AntiAFKState.IsInitializing=true;AntiAFKState.InitAttempts=AntiAFKState.InitAttempts + 1 ;print(                     
    "[防AFK] 启动整合防AFK系统 (尝试 "   .. AntiAFKState.InitAttempts   .. "/"   .. AntiAFKState.MaxInitAttempts   .. ")" );for _,connection in pairs(AntiAFKState.Connections) do  
    if connection then pcall(function() connection:Disconnect();end);end end AntiAFKState.Connections={};if AntiAFKState.HeartbeatConnection then pcall(function()        
      AntiAFKState.HeartbeatConnection:Disconnect();end);AntiAFKState.HeartbeatConnection=nil;end AntiAFKState.LastSignalTime=tick();AntiAFKState.LastVirtualUserTime=  
      tick();AntiAFKState.LastLogTime=tick();AntiAFKState.LastVirtualUserLogTime=tick();local UserInputService=game:GetService("UserInputService");local success1,conn1 
      =pcall(function() return UserInputService.InputChanged:Connect(onInputChanged);end);local success2,conn2=pcall(function() return UserInputService.InputBegan:     
        Connect(onInputBegan);end);if (success1 and conn1) then table.insert(AntiAFKState.Connections,conn1);end if (success2 and conn2) then table.insert(AntiAFKState 
        .Connections,conn2);end if UserInputService.TouchEnabled then local success3,conn3=pcall(function() return UserInputService.TouchStarted:Connect(onInputChanged 
        );end);local success4,conn4=pcall(function() return UserInputService.TouchMoved:Connect(onInputChanged);end);if (success3 and conn3) then table.insert(         
          AntiAFKState.Connections,conn3);end if (success4 and conn4) then table.insert(AntiAFKState.Connections,conn4);end end local success5,conn5=pcall(function() 
             return game:GetService("RunService").Heartbeat:Connect(function() checkAndSendSignal();end);end);if (success5 and conn5) then AntiAFKState.              
              HeartbeatConnection=conn5;table.insert(AntiAFKState.Connections,conn5);else print("[防AFK] 心跳连接失败");end AntiAFKState.IsRunning=true;AntiAFKState.        
                IsInitializing=false;AntiAFKState.InitAttempts=0;print("[防AFK] 防AFK系统已启动");print("[防AFK] 策略1: 用户输入触发 + 定时检查 (间隔: "   .. AntiAFKState.SignalInterval   
                     .. "秒)" );print("[防AFK] 策略2: VirtualUser模拟操作 (间隔: "   .. AntiAFKState.VirtualUserInterval   .. "秒)" );task.spawn(function() task.wait(1);      
                      checkAndSendSignal();end);return true;end local function stopAntiAFK() if  not AntiAFKState.IsRunning then return;end print("[防AFK] 停止防AFK系统" 
                                  );AntiAFKState.IsRunning=false;for _,connection in pairs(AntiAFKState.Connections) do if connection then pcall(function()         
                                      connection:Disconnect();end);end end AntiAFKState.Connections={};if AntiAFKState.HeartbeatConnection then pcall(function()    
                                      AntiAFKState.HeartbeatConnection:Disconnect();end);                   AntiAFKState.HeartbeatConnection=nil;end end local      
                                      function toggleCultivation() local xiulian=player:                    GetAttribute("Gathering");if (xiulian==true) then     
                                      print("[修炼] 已在修炼状态，退出修炼");GatherQiEvent:FireServer();                 CultState.isCultivating=false;else print(             
                                      "[修炼] 未在修炼状态，进入修炼");GatherQiEvent:FireServer();CultState.             isCultivating=true;end return CultState.isCultivating 
                                      ;end local function startAutoBreakthrough() if CultState.               isAutoBreakthrough then print("[突破] 自动突破已在运行中");    
                                      return;end CultState.isAutoBreakthrough=true;CultState.                 lastBreakthroughTime=0;if CultState.                
                                      breakthroughConnection then CultState.breakthroughConnection:           Disconnect();CultState.breakthroughConnection=nil 
                                        ;end CultState.breakthroughConnection=RunService.Heartbeat:           Connect(function() local currentTime=tick();if (( 
                                        currentTime-CultState.lastBreakthroughTime)>=CONFIG.                    BREAKTHROUGH_INTERVAL) then CultState.          
                                        lastBreakthroughTime=currentTime;if CultState.isCultivating              then BreakthroughEvent:FireServer();print(   
                                        "[突破] 发送突破请求");else print("[突破] 未在修炼状态，跳过突破");end end end               );print("[突破] 自动突破已启动（间隔: "   .. CONFIG.      
                                        BREAKTHROUGH_INTERVAL   .. "秒）" );end local function                      stopAutoBreakthrough() if  not CultState. 
                                        isAutoBreakthrough then print("[突破] 自动突破未在运行");return;end                  CultState.isAutoBreakthrough=false;if    
                                          CultState.breakthroughConnection then CultState.                          breakthroughConnection:Disconnect();  
                                          CultState.breakthroughConnection=nil;end print(                             "[突破] 自动突破已停止");end local       
                                            function breakthroughOnce() if  not CultState.                              isCultivating then print( 
                                            "[突破] 未在修炼状态，无法突破");return false;end                                                          
                                              BreakthroughEvent:FireServer();print(         
                                                "[突破] 单次突破请求已发送");return true;end local   
                                                    function startCraftPills(pillType,  
                                                          count) if PillState.    


isCrafting then print("[炼药] 炼药已在运行中");return false;end if ( not pillType or (pillType=="")) then print("[炼药] 请选择丹药类型");return false;end if ( not CraftPillEvent or  not CraftPillEvent.FireServer) then print("[炼药] 错误: 炼药事件未找到或无效");return false;end count=math.max(1,tonumber(count) or 1 );print(string.format("[炼药] 开始炼制 %s x%d (间隔: %d秒)",pillType,count,PillState.craftInterval));PillState.isCrafting=true;PillState.currentPillType=pillType;PillState.craftCount=count;task.spawn(function() local crafted=0;while PillState.isCrafting and (crafted<count)  do if ( not CraftPillEvent or  not CraftPillEvent.FireServer) then print("[炼药] 错误: 炼药事件丢失，停止炼药");break;end local success,err=pcall(function() CraftPillEvent:FireServer(pillType);end);if  not success then print("[炼药] 触发远程炼药事件失败: "   .. tostring(err) );break;end crafted=crafted + 1 ;print(string.format("[炼药] 触发远程炼药事件 (%d/%d) - 时间: %s",crafted,count,os.date("%H:%M:%S")));if (crafted<count) then local waitStart=tick();while PillState.isCrafting and ((tick() -waitStart)<PillState.craftInterval)  do task.wait(0.1);end end end if PillState.isCrafting then PillState.isCrafting=false;print(string.format("[炼药] 炼药完成，共炼制 %d 次",crafted));end end);return true;end local function stopCraftPills() if  not PillState.isCrafting then print("[炼药] 炼药未在运行");return false;end PillState.isCrafting=false;print("[炼药] 炼药已停止");return true;end local function craftSinglePill(pillType) if ( not pillType or (pillType=="")) then print("[炼药] 请选择丹药类型");return false;end if ( not CraftPillEvent or  not CraftPillEvent.FireServer) then print("[炼药] 错误: 炼药事件未找到或无效");return false;end local success,err=pcall(function() CraftPillEvent:FireServer(pillType);end);if success then print(string.format("[炼药] 触发单次炼药事件 - 时间: %s",os.date("%H:%M:%S")));else print("[炼药] 触发单次炼药事件失败: "   .. tostring(err) );end return success;end local function modifySingleHerbPickTime(herb) if  not herb then return false;end if HerbState.modifiedHerbs[herb] then return false;end local success=false;local modifiedCount=0;local function findAndChangePrompts(obj) for _,child in ipairs(obj:GetChildren()) do if child:IsA("ProximityPrompt") then child.HoldDuration=0;modifiedCount=modifiedCount + 1 ;success=true;if child:FindFirstChild("Data") then local data=child.Data;local holdTime=data:FindFirstChild("HoldDuration");if holdTime then holdTime.Value=0;modifiedCount=modifiedCount + 1 ;end end else findAndChangePrompts(child);end end end findAndChangePrompts(herb);if success then HerbState.modifiedHerbs[herb]=true;end return success;end local function setupQuickPickListener() if HerbState.quickPickConnection then HerbState.quickPickConnection:Disconnect();HerbState.quickPickConnection=nil;end if  not HerbState.quickPickEnabled then return;end print("[一键加速] 设置草药监控器");local herbsFolder=Workspace:FindFirstChild(CONFIG.HERBS_FOLDER_NAME);if herbsFolder then local count=0;for _,herb in ipairs(herbsFolder:GetChildren()) do if (herb and herb.Parent) then if modifySingleHerbPickTime(herb) then count=count + 1 ;end end end print(string.format("[一键加速] 已修改 %d 个现有草药",count));HerbState.quickPickConnection=herbsFolder.ChildAdded:Connect(function(child) if (child and child.Parent) then task.wait(0.3);if modifySingleHerbPickTime(child) then print("[一键加速] 新草药已修改: "   .. child.Name );end end end);else print("[一键加速] 警告: 未找到草药文件夹");end end local function autoCollectNearestAura() local character=player.Character;if  not character then return;end local humanoidRootPart=character:FindFirstChild("HumanoidRootPart");if  not humanoidRootPart then return;end local playerPos=humanoidRootPart.Position;local nearestPrompt=nil;local nearestDistance=math.huge;local function findProximityPrompt(obj) for _,child in ipairs(obj:GetChildren()) do if (child and child.Parent) then if child:IsA("ProximityPrompt") then local auraPos=nil;if obj:IsA("BasePart") then auraPos=obj.Position;elseif obj:IsA("Model") then if (obj.PrimaryPart and obj.PrimaryPart:IsA("BasePart")) then auraPos=obj.PrimaryPart.Position;else for _,part in ipairs(obj:GetChildren()) do if (part and part:IsA("BasePart")) then auraPos=part.Position;break;end end end end if auraPos then local distance=(auraPos-playerPos).Magnitude;if ((distance<AuraAutoCollectState.maxDistance) and (distance<nearestDistance)) then nearestDistance=distance;nearestPrompt=child;end end return;else findProximityPrompt(child);end end end end local function scanWorkspaceForAuras() for _,obj in ipairs(Workspace:GetChildren()) do if (obj and obj:IsA("Model") and (obj.Parent==Workspace)) then for _,child in ipairs(obj:GetChildren()) do if child:IsA("ProximityPrompt") then findProximityPrompt(obj);return;end end end end end local success,errorMsg=pcall(function() scanWorkspaceForAuras();end);if  not success then print("[功法自动收集] 扫描功法时出错: "   .. tostring(errorMsg) );return;end if nearestPrompt then local success,err=pcall(function() fireproximityprompt(nearestPrompt,player);end);if success then local promptParent=nearestPrompt.Parent;local name=(promptParent and promptParent.Name) or "未知功法" ;print(string.format("[功法自动收集] 触发功法: %s (距离: %.1f米)",name,nearestDistance));else print("[功法自动收集] 触发功法失败: "   .. tostring(err) );end end end local function autoHarvestNearestHerb() if  not HerbState.autoHarvestEnabled then return;end local character=player.Character;if  not character then return;end local humanoidRootPart=character:FindFirstChild("HumanoidRootPart");if  not humanoidRootPart then return;end local herbsFolder=Workspace:FindFirstChild("Herbs");if  not herbsFolder then for _,name in ipairs({"Herb","草药","Herbs","HerbCollection"}) do herbsFolder=Workspace:FindFirstChild(name);if herbsFolder then break;end end if  not herbsFolder then return;end end local playerPos=humanoidRootPart.Position;local nearestPrompt=nil;local nearestDistance=math.huge;local nearestHerbName="";for _,herb in ipairs(herbsFolder:GetChildren()) do if ( not herb or  not herb.Parent) then continue;end local function findProximityPrompt(obj) for _,child in ipairs(obj:GetChildren()) do if child:IsA("ProximityPrompt") then local herbPos=nil;if obj:IsA("BasePart") then herbPos=obj.Position;elseif obj:IsA("Model") then if (obj.PrimaryPart and obj.PrimaryPart:IsA("BasePart")) then herbPos=obj.PrimaryPart.Position;else for _,part in ipairs(obj:GetChildren()) do if part:IsA("BasePart") then herbPos=part.Position;break;end end end end if herbPos then local distance=(herbPos-playerPos).Magnitude;if ((distance<HerbState.autoHarvestMaxDistance) and (distance<nearestDistance)) then nearestDistance=distance;nearestPrompt=child;nearestHerbName=obj.Name;end end return;else findProximityPrompt(child);end end end findProximityPrompt(herb);end if nearestPrompt then local success,err=pcall(function() fireproximityprompt(nearestPrompt,player);end);if success then local currentTime=tick();if ((currentTime-HerbState.autoHarvestLastCollectTime)>3) then print(string.format("[自动采摘] 触发草药: %s (距离: %.1f米)",nearestHerbName,nearestDistance));HerbState.autoHarvestLastCollectTime=currentTime;end task.wait(0.2);elseif ((tick() -HerbState.autoHarvestLastCollectTime)>5) then print("[自动采摘] 触发草药失败: "   .. tostring(err) );end end end local function startAutoHarvest() if HerbState.autoHarvestConnection then stopAutoHarvest();end HerbState.autoHarvestEnabled=true;print(string.format("[自动采摘] 开启自动采摘 (%.1f秒间隔, 距离: %d米)",HerbState.autoHarvestCollectInterval,HerbState.autoHarvestMaxDistance));HerbState.autoHarvestConnection=RunService.Heartbeat:Connect(function() if HerbState.autoHarvestEnabled then autoHarvestNearestHerb();task.wait(HerbState.autoHarvestCollectInterval);end end);end local function stopAutoHarvest() HerbState.autoHarvestEnabled=false;print("[自动采摘] 关闭自动采摘");if HerbState.autoHarvestConnection then HerbState.autoHarvestConnection:Disconnect();HerbState.autoHarvestConnection=nil;end end local function toggleAuraAutoCollect() AuraAutoCollectState.enabled= not AuraAutoCollectState.enabled;if AuraAutoCollectState.enabled then print(string.format("[功法自动收集] 开启功法自动收集 (%.1f秒间隔, 距离: %d米)",AuraAutoCollectState.collectInterval,AuraAutoCollectState.maxDistance));if AuraAutoCollectState.connection then AuraAutoCollectState.connection:Disconnect();AuraAutoCollectState.connection=nil;end AuraAutoCollectState.connection=RunService.Heartbeat:Connect(function() autoCollectNearestAura();task.wait(AuraAutoCollectState.collectInterval);end);else print("[功法自动收集] 关闭功法自动收集");if AuraAutoCollectState.connection then AuraAutoCollectState.connection:Disconnect();AuraAutoCollectState.connection=nil;end end return AuraAutoCollectState.enabled;end local MobileToggleButton=nil;local MobileToggleGUI=nil;local function createMobileToggle() if CoreGui:FindFirstChild("HerbMobileToggle") then CoreGui.HerbMobileToggle:Destroy();end if (UserInputService.KeyboardEnabled and  not UserInputService.TouchEnabled) then print("[移动端] 检测到键盘设备，隐藏移动端按钮");return;end print("[移动端] 创建移动端切换按钮");local mobileToggleGUI=Instance.new("ScreenGui");mobileToggleGUI.Name="HerbMobileToggle";mobileToggleGUI.Parent=CoreGui;mobileToggleGUI.ResetOnSpawn=false;mobileToggleGUI.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;mobileToggleGUI.DisplayOrder=100;local toggleButton=Instance.new("TextButton");toggleButton.Name="ToggleButton";toggleButton.Parent=mobileToggleGUI;toggleButton.BackgroundColor3=Color3.fromRGB(40,60,40);toggleButton.BorderColor3=Color3.fromRGB(29,29,35);toggleButton.Position=UDim2.new(0.005,0,0.4,0);toggleButton.Size=UDim2.new(0,80,0,36);toggleButton.Font=Enum.Font.SourceSansBold;toggleButton.Text="打开界面";toggleButton.TextColor3=Color3.fromRGB(255,255,255);toggleButton.TextSize=14;toggleButton.Active=true;toggleButton.Draggable=true;toggleButton.Visible=true;local buttonCorner=Instance.new("UICorner");buttonCorner.CornerRadius=UDim.new(0,5);buttonCorner.Parent=toggleButton;MobileToggleButton=toggleButton;MobileToggleGUI=mobileToggleGUI;return mobileToggleGUI;end local function scanAuras() print("[功法扫描] ======= 开始扫描功法 =======");print("[功法扫描] 搜索方法: Workspace第一层Model，检查ProximityPrompt");local validAuras={};local success,errorMsg=pcall(function() for _,child in pairs(Workspace:GetChildren()) do if (child and child:IsA("Model") and (child.Parent==Workspace)) then local hasProximityPrompt=false;for _,descendant in pairs(child:GetChildren()) do if (descendant and descendant:IsA("ProximityPrompt")) then hasProximityPrompt=true;break;end end if hasProximityPrompt then table.insert(validAuras,child);print(string.format("[功法扫描] 找到功法: %s (包含ProximityPrompt)",child.Name));end end end end);if  not success then warn("[功法扫描] 扫描过程中发生错误: "   .. tostring(errorMsg) );end print(string.format("[功法扫描] 扫描完成，找到 %d 个有效功法", #validAuras));return validAuras;end local function StopAllMovement() if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity:Destroy();HerbState.FlightBodyVelocity=nil;end if HerbState.FlightBodyGyro then HerbState.FlightBodyGyro:Destroy();HerbState.FlightBodyGyro=nil;end if (humanoid and humanoid.Parent) then humanoid.PlatformStand=false;end if workspace then workspace.Gravity=HerbState.OriginalGravity;end if (humanoidRootPart and humanoidRootPart.Parent) then humanoidRootPart.AssemblyAngularVelocity=Vector3.new(0,0,0);humanoidRootPart.AssemblyLinearVelocity=Vector3.new(0,0,0);end HerbState.IsFlying=false;if HerbState.FlightConnection then HerbState.FlightConnection:Disconnect();HerbState.FlightConnection=nil;end end local function enableFlight() if (HerbState.IsFlying or  not humanoid or  not humanoidRootPart) then print("[飞行] 飞行已启用或角色组件不存在");return;end StopAllMovement();print("[飞行] 启用飞行模式...");humanoid.PlatformStand=true;workspace.Gravity=HerbState.OriginalGravity * 0.1 ;local bodyVelocity=Instance.new("BodyVelocity");bodyVelocity.Name="FlightVelocity";bodyVelocity.MaxForce=Vector3.new(100000,100000,100000);bodyVelocity.Velocity=Vector3.new(0,0,0);bodyVelocity.P=5000;bodyVelocity.Parent=humanoidRootPart;HerbState.FlightBodyVelocity=bodyVelocity;local bodyGyro=Instance.new("BodyGyro");bodyGyro.Name="FlightGyro";bodyGyro.MaxTorque=Vector3.new(100000,100000,100000);bodyGyro.CFrame=humanoidRootPart.CFrame;bodyGyro.P=3000;bodyGyro.D=1000;bodyGyro.Parent=humanoidRootPart;HerbState.FlightBodyGyro=bodyGyro;local lastUpdate=tick();HerbState.FlightConnection=RunService.Heartbeat:Connect(function() if ( not HerbState.IsFlying or  not humanoidRootPart or  not humanoidRootPart.Parent) then StopAllMovement();return;end local currentTime=tick();local deltaTime=currentTime-lastUpdate ;lastUpdate=currentTime;local targetY=CONFIG.FLY_HEIGHT;local currentY=humanoidRootPart.Position.Y;local heightDifference=targetY-currentY ;if (HerbState.FlightBodyVelocity and HerbState.FlightBodyVelocity.Parent) then local yVelocity=0;if (math.abs(heightDifference)>10) then yVelocity=heightDifference * 5 ;elseif (math.abs(heightDifference)>1) then yVelocity=heightDifference * 10 ;end HerbState.FlightBodyVelocity.Velocity=Vector3.new(HerbState.FlightBodyVelocity.Velocity.X,yVelocity,HerbState.FlightBodyVelocity.Velocity.Z);end if HerbState.FlightBodyGyro then HerbState.FlightBodyGyro.CFrame=humanoidRootPart.CFrame;end end);HerbState.IsFlying=true;end local function getHerbPosition(herb) if ( not herb or  not herb.Parent) then warn("[坐标] 对象不存在或已销毁");return Vector3.new(0,0,0);end local success,position=pcall(function() if herb:IsA("BasePart") then return herb.Position;end if herb:IsA("Model") then if (herb.PrimaryPart and herb.PrimaryPart:IsA("BasePart")) then return herb.PrimaryPart.Position;end local success2,pivotResult=pcall(function() return herb:GetPivot();end);if (success2 and pivotResult) then if (typeof(pivotResult)=="CFrame") then return pivotResult.Position;elseif (typeof(pivotResult)=="Vector3") then return pivotResult;end end for _,child in ipairs(herb:GetChildren()) do if child:IsA("BasePart") then return child.Position;end end end return Vector3.new(0,0,0);end);if (success and position) then return position;else warn("[坐标] 获取对象位置时发生错误: "   .. ((herb and herb.Name) or "未知对象")   .. " - "   .. tostring(position) );return Vector3.new(0,0,0);end end local function getAuraPosition(auraModel) if ( not auraModel or  not auraModel.Parent) then warn("[功法坐标] 功法Model不存在或已销毁");return Vector3.new(0,0,0);end local success,result=pcall(function() if auraModel:IsA("Model") then local success2,pivotResult=pcall(function() return auraModel:GetPivot();end);if (success2 and pivotResult and (typeof(pivotResult)=="CFrame")) then return pivotResult.Position;end if (auraModel.PrimaryPart and auraModel.PrimaryPart:IsA("BasePart")) then return auraModel.PrimaryPart.Position;end for _,child in ipairs(auraModel:GetChildren()) do if child:IsA("BasePart") then return child.Position;end end end for _,child in ipairs(auraModel:GetDescendants()) do if child:IsA("ProximityPrompt") then local parent=child.Parent;if parent then if parent:IsA("BasePart") then return parent.Position;elseif parent:IsA("Model") then local parentPos=parent.PrimaryPart and parent.PrimaryPart.Position ;if parentPos then return parentPos;end end end break;end end return Vector3.new(0,0,0);end);if (success and result) then return result;else warn("[功法坐标] 获取功法位置时发生错误");return Vector3.new(0,0,0);end end local function getHerbAge(herb) if ( not herb or  not herb.Parent) then return 0;end if (HerbState.herbAgeCache[herb]~=nil) then return HerbState.herbAgeCache[herb];end local age=0;local isAura=false;if herb:IsA("Model") then for _,child in ipairs(herb:GetChildren()) do if child:IsA("ProximityPrompt") then isAura=true;break;end end end if isAura then HerbState.herbAgeCache[herb]=0;return 0;end if herb:IsA("Model") then local success,result=pcall(function() return herb:GetAttribute("Age");end);if (success and (result~=nil)) then age=tonumber(result) or 0 ;elseif (herb:FindFirstChild("AgeValue") and herb.AgeValue:IsA("ValueBase")) then age=tonumber(herb.AgeValue.Value) or 0 ;elseif herb:FindFirstChild("Age") then local ageObj=herb:FindFirstChild("Age");if ageObj:IsA("ValueBase") then age=tonumber(ageObj.Value) or 0 ;end end else local success,result=pcall(function() return herb:GetAttribute("Age");end);if (success and (result~=nil)) then age=tonumber(result) or 0 ;elseif herb:FindFirstChild("AgeValue") then age=tonumber(herb.AgeValue.Value) or 0 ;elseif herb:FindFirstChild("Age") then age=tonumber(herb.Age) or 0 ;end end HerbState.herbAgeCache[herb]=age;return age;end local function getHerbPriority(herbName) if ( not herbName or ( #HerbState.priorityHerbs==0)) then return nil;end for _,priorityHerb in ipairs(HerbState.priorityHerbs) do if (priorityHerb.name==herbName) then return priorityHerb.priority;end end return nil;end local function scanHerbs() local herbsFolder=Workspace:FindFirstChild(CONFIG.HERBS_FOLDER_NAME);if  not herbsFolder then warn("[扫描] 未找到草药文件夹："   .. CONFIG.HERBS_FOLDER_NAME );local alternativeFolders={"Herb","Herbs","草药","草药采集","植物","Plants"};for _,folderName in ipairs(alternativeFolders) do local folder=Workspace:FindFirstChild(folderName);if (folder and (folder:IsA("Folder") or folder:IsA("Model"))) then herbsFolder=folder;print("[扫描] 找到替代草药文件夹："   .. folderName );break;end end if  not herbsFolder then print("[扫描] 警告：完全找不到草药文件夹，尝试遍历Workspace");local allHerbs={};for _,child in ipairs(Workspace:GetChildren()) do if (child and child.Parent) then local isHerb=false;local herbKeywords={"Herb","Growth","Plant","草药","草","药"};for _,keyword in ipairs(herbKeywords) do if child.Name:find(keyword) then isHerb=true;break;end end local function hasProximityPrompt(obj) for _,descendant in ipairs(obj:GetDescendants()) do if descendant:IsA("ProximityPrompt") then return true;end end return false;end if  not isHerb then isHerb=hasProximityPrompt(child);end if (isHerb and (child:IsA("Model") or child:IsA("BasePart") or child:IsA("MeshPart"))) then local isBlacklisted=false;for _,blacklistName in ipairs(CONFIG.BLACKLIST_HERBS) do if ((child.Name==blacklistName) or child.Name:match(blacklistName)) then isBlacklisted=true;print(string.format("[扫描] 跳过黑名单草药: %s",child.Name));break;end end if  not isBlacklisted then table.insert(allHerbs,child);end end end end print("[扫描] 通过遍历找到草药数量："   ..  #allHerbs );return allHerbs;end end local validHerbs={};local currentTime=tick();local scanCount=0;local skipCount=0;local function scanFolderContents(folder) for _,item in ipairs(folder:GetChildren()) do if ( not item or  not item.Parent) then continue;end scanCount=scanCount + 1 ;local isBlacklisted=false;for _,blacklistName in ipairs(CONFIG.BLACKLIST_HERBS) do if ((item.Name==blacklistName) or item.Name:match(blacklistName)) then isBlacklisted=true;skipCount=skipCount + 1 ;break;end end if isBlacklisted then continue;end local isCollected=false;for collectedHerb,collectedTime in pairs(HerbState.collectedHerbs) do if (collectedHerb and (collectedHerb==item) and ((currentTime-collectedTime)<600)) then isCollected=true;skipCount=skipCount + 1 ;break;end end local isTimedOut=false;for timeoutHerb,timeoutTime in pairs(HerbState.timeoutHerbs) do if (timeoutHerb and (timeoutHerb==item) and ((currentTime-timeoutTime)<CONFIG.TIMEOUT_COOLDOWN)) then isTimedOut=true;skipCount=skipCount + 1 ;break;end end local isCurrentTarget=HerbState.currentHerb and (HerbState.currentHerb==item) ;local isValidType=item:IsA("MeshPart") or item:IsA("Part") or item:IsA("Model") or item:IsA("UnionOperation") or item:IsA("WedgePart") ;if item:IsA("Model") then local hasParts=false;if item.PrimaryPart then hasParts=true;else for _,child in ipairs(item:GetChildren()) do if child:IsA("BasePart") then hasParts=true;break;end end end local hasPrompt=false;for _,child in ipairs(item:GetDescendants()) do if child:IsA("ProximityPrompt") then hasPrompt=true;break;end end if ( not hasParts and  not hasPrompt) then skipCount=skipCount + 1 ;continue;end end if (isValidType and  not isCollected and  not isTimedOut and ( not isCurrentTarget or  not item.Parent)) then table.insert(validHerbs,item);if HerbState.quickPickEnabled then modifySingleHerbPickTime(item);end else skipCount=skipCount + 1 ;end if (item:IsA("Folder") or item:IsA("Model")) then scanFolderContents(item);end end end scanFolderContents(herbsFolder);if (scanCount>0) then print(string.format("[扫描] 统计: 扫描 %d 个对象，有效草药 %d 个，跳过 %d 个",scanCount, #validHerbs,skipCount));if ((skipCount>50) and ( #validHerbs==0)) then print("[扫描] 警告：跳过太多对象且没有有效草药，考虑重置状态");task.spawn(function() resetScanState();print("[扫描] 已执行重置扫描状态");end);end else print("[扫描] 警告：没有扫描到任何对象");end return validHerbs;end local function filterHerbsByPriority(herbs) if ( #HerbState.priorityHerbs==0) then return herbs,{},false;end local priorityHerbs={};local nonPriorityHerbs={};local priorityMap={};for _,priorityHerb in ipairs(HerbState.priorityHerbs) do priorityMap[priorityHerb.name]=priorityHerb.priority;end for _,herb in ipairs(herbs) do if (herb and herb.Parent) then local priority=priorityMap[herb.Name];if priority then table.insert(priorityHerbs,{herb=herb,priority=priority});else table.insert(nonPriorityHerbs,herb);end end end local formattedPriorityHerbs={};for _,info in ipairs(priorityHerbs) do table.insert(formattedPriorityHerbs,info);end return formattedPriorityHerbs,nonPriorityHerbs,true;end local function findBestTarget() if (HerbState.currentHerb and HerbState.currentHerb.Parent) then local isStillValid=true;for collectedHerb,collectedTime in pairs(HerbState.collectedHerbs) do if (collectedHerb==HerbState.currentHerb) then isStillValid=false;break;end end for timeoutHerb,timeoutTime in pairs(HerbState.timeoutHerbs) do if ((timeoutHerb==HerbState.currentHerb) and ((tick() -timeoutTime)<CONFIG.TIMEOUT_COOLDOWN)) then isStillValid=false;break;end end if isStillValid then print("[寻找] 当前目标仍然有效: "   .. HerbState.currentHerb.Name );if ((HerbState.targetMode=="aura") or (HerbState.targetMode=="both")) then local function isAura(obj) for _,child in ipairs(obj:GetDescendants()) do if child:IsA("ProximityPrompt") then return true;end end return false;end if isAura(HerbState.currentHerb) then print("[寻找] 当前目标是功法，优先处理");return HerbState.currentHerb,true;end end return HerbState.currentHerb,false;else print("[寻找] 当前目标已失效，重新寻找");HerbState.currentHerb=nil;end end if ((HerbState.targetMode=="aura") or (HerbState.targetMode=="both")) then local allAuras=scanAuras();if ( #allAuras>0) then print("[寻找] 找到功法，优先采集功法");local closestAura=nil;local closestDistance=math.huge;local playerPos=(humanoidRootPart and humanoidRootPart.Position) or Vector3.new(0,0,0) ;for _,aura in ipairs(allAuras) do if (aura and aura.Parent) then local auraPos=getAuraPosition(aura);if (auraPos and (auraPos~=Vector3.new(0,0,0))) then local distance=(auraPos-playerPos).Magnitude;if (distance<closestDistance) then closestDistance=distance;closestAura=aura;end end end end if closestAura then AuraState.currentAura=closestAura;HerbState.currentHerb=nil;print(string.format("[寻找] 选择功法: %s (距离: %.1f米)",closestAura.Name,closestDistance));return closestAura,true;else print("[寻找] 虽然扫描到功法，但所有功法都无法访问");end else print("[寻找] 未找到任何功法");end end if ((HerbState.targetMode=="herb") or (HerbState.targetMode=="both")) then AuraState.currentAura=nil;local allHerbs=scanHerbs();if ( #allHerbs==0) then print("[寻找] 未找到任何有效草药");HerbState.failCount=HerbState.failCount + 1 ;if (HerbState.failCount>=3) then print("[寻找] 连续3次未找到目标，执行深度清理");HerbState.collectedHerbs={};HerbState.timeoutHerbs={};HerbState.herbAgeCache={};HerbState.modifiedHerbs={};HerbState.failCount=0;task.wait(2);allHerbs=scanHerbs();if ( #allHerbs==0) then print("[寻找] 深度清理后仍未找到目标，检查游戏状态");local herbsFolder=Workspace:FindFirstChild(CONFIG.HERBS_FOLDER_NAME);if  not herbsFolder then print("[寻找] 错误：草药文件夹不存在，可能游戏状态异常");else print(string.format("[寻找] 草药文件夹存在，子对象数量: %d", #herbsFolder:GetChildren()));end print("[寻找] 尝试放宽扫描条件...");allHerbs=scanHerbs();end end if ( #allHerbs==0) then return nil,false;end else HerbState.failCount=0;end local priorityHerbs,nonPriorityHerbs,hasPriority=filterHerbsByPriority(allHerbs);if (hasPriority and ( #priorityHerbs>0)) then print(string.format("[优先级] 用户选择了 %d 种优先级草药", #HerbState.priorityHerbs));local allPriorityHerbs={};local playerPos=(humanoidRootPart and humanoidRootPart.Position) or Vector3.new(0,0,0) ;for _,priorityInfo in ipairs(priorityHerbs) do local herb=priorityInfo.herb;local priority=priorityInfo.priority;if (herb and herb.Parent) then local age=getHerbAge(herb);local herbPos=getHerbPosition(herb);local distance=(herbPos-playerPos).Magnitude;table.insert(allPriorityHerbs,{herb=herb,priority=priority,age=age,distance=distance});end end if ( #allPriorityHerbs>0) then table.sort(allPriorityHerbs,function(a,b) if (a.age~=b.age) then return a.age>b.age ;else return a.distance<b.distance ;end end);local bestHerb=allPriorityHerbs[1].herb;local bestAge=allPriorityHerbs[1].age;local bestDistance=allPriorityHerbs[1].distance;print(string.format("[优先级] 选择年份最大草药: %s (年份: %d, 距离: %.1f米)",bestHerb.Name,bestAge,bestDistance));return bestHerb,false;end end local herbsToCheck=nonPriorityHerbs;if  not hasPriority then herbsToCheck=allHerbs;end if ( #herbsToCheck>0) then print(string.format("[寻找] 在 %d 个草药中寻找年份最大的", #herbsToCheck));local herbInfoList={};local playerPos=humanoidRootPart.Position;for _,herb in ipairs(herbsToCheck) do if (herb and herb.Parent) then local age=getHerbAge(herb);local herbPos=getHerbPosition(herb);local distance=(herbPos-playerPos).Magnitude;table.insert(herbInfoList,{herb=herb,age=age,distance=distance});end end if ( #herbInfoList==0) then print("[寻找] 没有可用的草药");return nil,false;end table.sort(herbInfoList,function(a,b) if (a.age~=b.age) then return a.age>b.age ;else return a.distance<b.distance ;end end);local bestHerb=herbInfoList[1].herb;local bestAge=herbInfoList[1].age;local bestDistance=herbInfoList[1].distance;print(string.format("[寻找] 选择年份最大草药: %s (年份: %d, 距离: %.1f米)",bestHerb.Name,bestAge,bestDistance));return bestHerb,false;end end print("[寻找] 没有可用的目标");return nil,false;end local function flyToTarget(target,isAura) if ( not target or  not HerbState.IsFlying) then warn("[飞行] 飞行模式未启用或目标不存在");return false;end if ( not HerbState.FlightBodyVelocity or  not HerbState.FlightBodyVelocity.Parent) then print("[飞行] 飞行组件不存在，重新创建");enableFlight();task.wait(0.5);end local targetType=(isAura and "功法") or "草药" ;local startTime=tick();if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity.Velocity=Vector3.new(0,0,0);end local checkCount=0;local lastDistance=math.huge;local stagnantCount=0;while HerbState.isRunning and target and target.Parent  do if ( not HerbState.FlightBodyVelocity or  not HerbState.FlightBodyVelocity.Parent) then warn("[飞行] 飞行组件已销毁，重新创建");enableFlight();task.wait(0.5);end if ((tick() -startTime)>CONFIG.MOVE_TIMEOUT) then warn("[飞行] 前往"   .. targetType   .. "超时（超过"   .. CONFIG.MOVE_TIMEOUT   .. "秒）" );if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity.Velocity=Vector3.new(0,0,0);end HerbState.timeoutHerbs[target]=tick();HerbState.currentTimeoutCount=HerbState.currentTimeoutCount + 1 ;print("[飞行] 已将"   .. targetType   .. " "   .. target.Name   .. " 加入超时列表" );return false;end local targetPos=nil;local success,posResult=pcall(function() if isAura then return getAuraPosition(target);else return getHerbPosition(target);end end);if (success and posResult) then targetPos=posResult;else warn("[飞行] 无法获取"   .. targetType   .. "位置: "   .. target.Name );HerbState.timeoutHerbs[target]=tick();HerbState.currentTimeoutCount=HerbState.currentTimeoutCount + 1 ;return false;end local flyHeight=CONFIG.FLY_HEIGHT;local targetFlyPos=Vector3.new(targetPos.X,flyHeight,targetPos.Z);local currentPos=humanoidRootPart.Position;local horizontalDistance=Vector3.new(targetPos.X,0,targetPos.Z).Magnitude-Vector3.new(currentPos.X,0,currentPos.Z).Magnitude ;local actualHorizontalDistance=(Vector3.new(targetPos.X,0,targetPos.Z) -Vector3.new(currentPos.X,0,currentPos.Z)).Magnitude;local verticalDistance=math.abs(flyHeight-currentPos.Y );local totalDistance=(targetFlyPos-currentPos).Magnitude;if (actualHorizontalDistance<=CONFIG.MOVE_DISTANCE_THRESHOLD) then if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity.Velocity=Vector3.new(0,0,0);end HerbState.currentTimeoutCount=0;print(string.format("[飞行] 到达%s %s 正上方（水平距离：%.1f米，垂直距离：%.1f米）",targetType,target.Name,actualHorizontalDistance,verticalDistance));return true;end if (actualHorizontalDistance>=(lastDistance-0.1)) then stagnantCount=stagnantCount + 1 ;else stagnantCount=0;end lastDistance=actualHorizontalDistance;if (stagnantCount>20) then print(string.format("[飞行] 飞行停滞，尝试调整 (停滞次数: %d)",stagnantCount));if (actualHorizontalDistance<50) then if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity.Velocity=Vector3.new(0,0,0);end HerbState.currentTimeoutCount=0;print(string.format("[飞行] 飞行停滞但水平距离较近(%.1f米)，认为已到达",actualHorizontalDistance));return true;end stagnantCount=0;end local direction=(targetFlyPos-currentPos).Unit;local verticalSpeed=0;local heightDiff=targetFlyPos.Y-currentPos.Y ;if (math.abs(heightDiff)>10) then verticalSpeed=math.clamp(heightDiff * 2 , -80,80);end local horizontalSpeed=CONFIG.FLY_SPEED;local velocity=Vector3.new(direction.X * horizontalSpeed ,verticalSpeed,direction.Z * horizontalSpeed );if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity.Velocity=velocity;else warn("[飞行] FlightBodyVelocity不存在");return false;end task.wait();end if (HerbState.FlightBodyVelocity and HerbState.FlightBodyVelocity.Parent) then HerbState.FlightBodyVelocity.Velocity=Vector3.new(0,0,0);end if (target and target.Parent) then HerbState.timeoutHerbs[target]=tick();HerbState.currentTimeoutCount=HerbState.currentTimeoutCount + 1 ;print("[飞行] "   .. targetType   .. "已销毁，已加入超时列表" );end warn("[飞行] "   .. targetType   .. "已销毁或系统已停止，终止飞行" );return false;end local function descendToCollectHeight(target,isAura) if ( not target or  not target.Parent) then warn("[下降] 目标不存在，无法下降");return false;end local targetType=(isAura and "功法") or "草药" ;print("[高度] 开始下降到"   .. targetType   .. "采集高度" );if ( not humanoid or  not humanoidRootPart) then warn("[下降] 角色组件缺失");return false;end if (HerbState.FlightBodyVelocity and HerbState.FlightBodyVelocity.Parent) then HerbState.FlightBodyVelocity.Velocity=Vector3.new(0,0,0);end if (HerbState.FlightBodyGyro and HerbState.FlightBodyGyro.Parent) then HerbState.FlightBodyGyro:Destroy();HerbState.FlightBodyGyro=nil;end HerbState.IsFlying=false;if HerbState.FlightConnection then HerbState.FlightConnection:Disconnect();HerbState.FlightConnection=nil;end workspace.Gravity=HerbState.OriginalGravity;local targetPos=Vector3.new(0,0,0);local function findProximityPromptAndGetPosition(obj) for _,child in ipairs(obj:GetDescendants()) do if child:IsA("ProximityPrompt") then local parent=child.Parent;if parent then if parent:IsA("BasePart") then return parent.Position;elseif parent:IsA("Model") then if parent.PrimaryPart then return parent.PrimaryPart.Position;else for _,part in ipairs(parent:GetChildren()) do if part:IsA("BasePart") then return part.Position;end end end end end break;end end return nil;end local success,result=pcall(function() return findProximityPromptAndGetPosition(target);end);if (success and result) then targetPos=result;print("["   .. targetType   .. "下降] 通过ProximityPrompt找到位置: "   .. tostring(targetPos) );else if isAura then local success2,posResult=pcall(function() return getAuraPosition(target);end);if (success2 and posResult) then targetPos=posResult;end else local success2,posResult=pcall(function() return getHerbPosition(target);end);if (success2 and posResult) then targetPos=posResult;end end print("["   .. targetType   .. "下降] 使用备用方法获取位置: "   .. tostring(targetPos) );end if (targetPos==Vector3.new(0,0,0)) then warn("[下降] 无法获取目标位置，使用当前位置上方5米");targetPos=humanoidRootPart.Position-Vector3.new(0,5,0) ;end local heightOffset=(isAura and 2) or CONFIG.NORMAL_HEIGHT_OFFSET ;local targetHeight=targetPos.Y + heightOffset ;print(string.format("[下降] %s原始Y: %.2f，目标高度Y: %.2f，偏移: %d",targetType,targetPos.Y,targetHeight,heightOffset));local currentY=humanoidRootPart.Position.Y;if (targetHeight>currentY) then print(string.format("[下降] 目标高度(%.2f)高于当前位置(%.2f)，调整下降目标",targetHeight,currentY));targetHeight=currentY-5 ;end local finalTargetPos=Vector3.new(targetPos.X,targetHeight,targetPos.Z);print("[下降] 最终目标位置: "   .. tostring(finalTargetPos) );print("[下降] 当前玩家位置: "   .. tostring(humanoidRootPart.Position) );print(string.format("[下降] 垂直距离: %.2f米",currentY-targetHeight ));humanoid.PlatformStand=false;humanoidRootPart.AssemblyLinearVelocity=Vector3.new(0,0,0);humanoidRootPart.AssemblyAngularVelocity=Vector3.new(0,0,0);local tweenCompleted=false;local tween;if (finalTargetPos~=Vector3.new(0,0,0)) then print("[下降] 创建Tween动画，持续时间: "   .. CONFIG.HEIGHT_TWEEN_TIME   .. "秒" );tween=TweenService:Create(humanoidRootPart,TweenInfo.new(CONFIG.HEIGHT_TWEEN_TIME,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{Position=finalTargetPos});tween.Completed:Connect(function() tweenCompleted=true;print("[下降] Tween动画完成，最终位置: "   .. tostring(humanoidRootPart.Position) );end);tween:Play();print("[下降] Tween动画已开始");else warn("[下降] 目标位置无效，跳过Tween动画");humanoidRootPart.Position=finalTargetPos;tweenCompleted=true;end local waitStart=tick();local maxWaitTime=CONFIG.HEIGHT_TWEEN_TIME * 3 ;local waitCount=0;while  not tweenCompleted and ((tick() -waitStart)<maxWaitTime)  do local progress=(tick() -waitStart)/CONFIG.HEIGHT_TWEEN_TIME ;local currentPos=humanoidRootPart.Position;waitCount=waitCount + 1 ;if ((waitCount%5)==0) then print(string.format("[下降] 进度: %.1f%% 当前位置: (%.2f, %.2f, %.2f)",math.min(progress * 100 ,100),currentPos.X,currentPos.Y,currentPos.Z));end task.wait(0.1);end if  not tweenCompleted then warn("[下降] 下降动画超时，强制设置位置");if tween then tween:Cancel();end humanoidRootPart.Position=finalTargetPos;else print("[下降] 下降动画成功完成");end humanoid.PlatformStand=false;humanoidRootPart.AssemblyLinearVelocity=Vector3.new(0,0,0);print(string.format("[高度] 已下降到%s采集高度（%.2f米），等待用户采集",targetType,targetHeight));return true;end local function ascendToFlyHeight() print("[高度] 开始上升回飞行高度");humanoid.PlatformStand=true;workspace.Gravity=HerbState.OriginalGravity * 0.1 ;local targetPos=Vector3.new(humanoidRootPart.Position.X,CONFIG.FLY_HEIGHT,humanoidRootPart.Position.Z);local tweenCompleted=false;local tween=TweenService:Create(humanoidRootPart,TweenInfo.new(1,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{Position=targetPos});tween.Completed:Connect(function() tweenCompleted=true;end);tween:Play();local waitTime=0;while  not tweenCompleted and (waitTime<2)  do waitTime+=task.wait(0.1) end if  not tweenCompleted then warn("[高度] 上升动画超时，强制设置位置");tween:Cancel();humanoidRootPart.Position=targetPos;end enableFlight();HerbState.currentHerb=nil;AuraState.currentAura=nil;print("[高度] 已回到飞行高度");end local function waitForPlayerCollect(target,isAura) if  not target then local targetType=(isAura and "功法") or "草药" ;print("[采集] "   .. targetType   .. "不存在，终止等待" );return false;end local targetType=(isAura and "功法") or "草药" ;print("[采集] 等待用户采集"   .. targetType   .. "："   .. target.Name   .. "（超时："   .. CONFIG.COLLECT_TIMEOUT   .. "秒）" );local startTime=tick();local checkInterval=0.2;while HerbState.isRunning do if ( not target:IsDescendantOf(Workspace) or  not target.Parent) then print("[采集] 检测到"   .. targetType   .. "已被采集" );HerbState.collectedHerbs[target]=true;HerbState.herbAgeCache[target]=nil;HerbState.timeoutHerbs[target]=nil;HerbState.currentTimeoutCount=0;HerbState.retryAttempts=0;return true;end local elapsedTime=tick() -startTime ;if (elapsedTime>=CONFIG.COLLECT_TIMEOUT) then print("[采集] 采集超时（"   .. CONFIG.COLLECT_TIMEOUT   .. "秒未采集）" );HerbState.timeoutHerbs[target]=tick();HerbState.currentTimeoutCount=HerbState.currentTimeoutCount + 1 ;print("[采集] 已将"   .. targetType   .. " "   .. target.Name   .. " 加入超时列表（冷却时间："   .. CONFIG.TIMEOUT_COOLDOWN   .. "秒）" );return false;end task.wait(checkInterval);end print("[采集] 系统已停止，终止等待");return false;end local function findAlternativeTarget(excludeTarget,excludeIsAura) print("[寻找] 正在寻找替代目标...");if ((HerbState.targetMode=="aura") or (HerbState.targetMode=="both")) then local allAuras=scanAuras();if ( #allAuras>0) then for _,aura in ipairs(allAuras) do if (aura and (aura~=excludeTarget) and aura.Parent) then local isTimedOut=false;for timeoutAura,timeoutTime in pairs(HerbState.timeoutHerbs) do if (timeoutAura and (timeoutAura==aura)) then if ((tick() -timeoutTime)<CONFIG.TIMEOUT_COOLDOWN) then isTimedOut=true;end break;end end if  not isTimedOut then local auraPos=getAuraPosition(aura);local currentPos=(excludeTarget and getHerbPosition(excludeTarget)) or humanoidRootPart.Position ;local distance=(auraPos-currentPos).Magnitude;print(string.format("[寻找] 找到替代功法: %s (距离: %.1f米)",aura.Name,distance));return aura,true;end end end end end if ((HerbState.targetMode=="herb") or (HerbState.targetMode=="both")) then local allHerbs=scanHerbs();if ( #allHerbs==0) then print("[寻找] 未找到任何替代目标");return nil,false;end local priorityHerbs,nonPriorityHerbs,hasPriority=filterHerbsByPriority(allHerbs);local herbInfoList={};local currentPos=(excludeTarget and getHerbPosition(excludeTarget)) or humanoidRootPart.Position ;if (hasPriority and ( #priorityHerbs>0)) then for _,priorityInfo in ipairs(priorityHerbs) do local herb=priorityInfo.herb;local priority=priorityInfo.priority;if (herb and (herb~=excludeTarget) and herb.Parent) then local isTimedOut=false;for timeoutHerb,timeoutTime in pairs(HerbState.timeoutHerbs) do if (timeoutHerb and (timeoutHerb==herb)) then if ((tick() -timeoutTime)<CONFIG.TIMEOUT_COOLDOWN) then isTimedOut=true;end break;end end if  not isTimedOut then local age=getHerbAge(herb);local herbPos=getHerbPosition(herb);local distance=(herbPos-currentPos).Magnitude;table.insert(herbInfoList,{herb=herb,age=age,distance=distance,isPriority=true,priority=priority});end end end end for _,herb in ipairs(nonPriorityHerbs) do if (herb and (herb~=excludeTarget) and herb.Parent) then local isTimedOut=false;for timeoutHerb,timeoutTime in pairs(HerbState.timeoutHerbs) do if (timeoutHerb and (timeoutHerb==herb)) then if ((tick() -timeoutTime)<CONFIG.TIMEOUT_COOLDOWN) then isTimedOut=true;end break;end end if  not isTimedOut then local age=getHerbAge(herb);local herbPos=getHerbPosition(herb);local distance=(herbPos-currentPos).Magnitude;table.insert(herbInfoList,{herb=herb,age=age,distance=distance,isPriority=false});end end end if ( #herbInfoList==0) then print("[寻找] 没有其他可用的替代目标");return nil,false;end table.sort(herbInfoList,function(a,b) if (a.isPriority and b.isPriority) then if (a.priority~=b.priority) then return a.priority<b.priority ;elseif (a.age~=b.age) then return a.age>b.age ;else return a.distance<b.distance ;end elseif (a.isPriority and  not b.isPriority) then return true;elseif ( not a.isPriority and b.isPriority) then return false;elseif (a.age~=b.age) then return a.age>b.age ;else return a.distance<b.distance ;end end);local bestAlternative=herbInfoList[1].herb;local bestAge=herbInfoList[1].age;local bestDistance=herbInfoList[1].distance;print(string.format("[寻找] 找到最佳替代草药: %s (年份: %d, 距离: %.1f米)",bestAlternative.Name,bestAge,bestDistance));return bestAlternative,false;end print("[寻找] 没有其他可用的替代目标");return nil,false;end local function resetScanState() print("[重置] 正在重置扫描状态...");HerbState.collectedHerbs={};HerbState.timeoutHerbs={};HerbState.herbAgeCache={};HerbState.modifiedHerbs={};print("[重置] 扫描状态已重置");end local function mainLoop() print("[主流程] 启动，开始寻找目标...");if ( #HerbState.priorityHerbs>0) then print("[主流程] 优先级草药设置:");for _,priorityHerb in ipairs(HerbState.priorityHerbs) do print(string.format("  优先级%d: %s",priorityHerb.priority,priorityHerb.name));end else print("[主流程] 未设置优先级草药");end print("[主流程] 目标模式: "   .. HerbState.targetMode );print("[主流程] 黑名单草药: "   .. table.concat(CONFIG.BLACKLIST_HERBS,", ") );HerbState.currentTimeoutCount=0;HerbState.failCount=0;while HerbState.isRunning do if  not HerbState.isRunning then break;end HerbState.currentHerb=nil;AuraState.currentAura=nil;local tempCollected={};local currentTime=tick();local cleanupTime=currentTime-600 ;for herb,collectedTime in pairs(HerbState.collectedHerbs) do if (collectedTime>cleanupTime) then tempCollected[herb]=collectedTime;end end HerbState.collectedHerbs=tempCollected;local success,bestTarget,isAura=pcall(function() return findBestTarget();end);if  not success then print("[主流程] 寻找目标时发生错误，2秒后重试");warn("[主流程] 错误详情: "   .. tostring(bestTarget) );disableFlight();task.wait(2);continue;end if  not bestTarget then print("[主流程] 未找到任何目标，2秒后重试");disableFlight();task.wait(2);continue;end if  not HerbState.isRunning then break;end if isAura then AuraState.currentAura=bestTarget;print(string.format("[主流程] 选择功法：%s",bestTarget.Name));else HerbState.currentHerb=bestTarget;local priority=getHerbPriority(bestTarget.Name);print(string.format("[主流程] 选择草药：%s%s",bestTarget.Name,(priority and (" [优先级"   .. priority   .. "]")) or "" ));end enableFlight();local flightReady=false;for i=1,20 do if  not HerbState.isRunning then break;end if (HerbState.IsFlying and HerbState.FlightBodyVelocity) then flightReady=true;break;end task.wait(0.1);end if  not HerbState.isRunning then break;end if  not flightReady then print("[主流程] 飞行模式未能启用，重新尝试");enableFlight();task.wait(1);if  not HerbState.IsFlying then print("[主流程] 飞行模式仍然未启用，跳过当前目标");task.wait(2);continue;end end print("[主流程] 开始飞行到目标...");local reachSuccess=flyToTarget(bestTarget,isAura);if  not HerbState.isRunning then disableFlight();break;end if  not reachSuccess then print("[主流程] 未能到达目标位置，寻找替代目标...");local alternativeTarget,altIsAura=findAlternativeTarget(bestTarget,isAura);if alternativeTarget then print("[主流程] 找到替代目标："   .. alternativeTarget.Name );if altIsAura then AuraState.currentAura=alternativeTarget;else HerbState.currentHerb=alternativeTarget;end local altReachSuccess=flyToTarget(alternativeTarget,altIsAura);if  not altReachSuccess then print("[主流程] 替代目标也无法到达，继续寻找下一个...");if HerbState.isRunning then ascendToFlyHeight();end task.wait(1);continue;end bestTarget=alternativeTarget;isAura=altIsAura;else print("[主流程] 未找到替代目标，2秒后重新寻找");if HerbState.isRunning then ascendToFlyHeight();end task.wait(2);continue;end end print("[主流程] 飞行到达成功，准备下降...");if  not HerbState.isRunning then disableFlight();break;end print("[主流程] 开始下降到采集高度...");local descendSuccess=descendToCollectHeight(bestTarget,isAura);if  not descendSuccess then print("[主流程] 下降失败，寻找替代目标...");local alternativeTarget,altIsAura=findAlternativeTarget(bestTarget,isAura);if alternativeTarget then print("[主流程] 找到替代目标："   .. alternativeTarget.Name );if altIsAura then AuraState.currentAura=alternativeTarget;else HerbState.currentHerb=alternativeTarget;end print("[主流程] 重新前往替代目标...");if HerbState.isRunning then ascendToFlyHeight();end task.wait(1);continue;else print("[主流程] 未找到替代目标，2秒后重新寻找");if HerbState.isRunning then ascendToFlyHeight();end task.wait(2);continue;end end if  not HerbState.isRunning then disableFlight();break;end print("[主流程] 下降完成，等待用户采集...");local collectSuccess=waitForPlayerCollect(bestTarget,isAura);if collectSuccess then print("[主流程] 目标采集成功，准备下一个");if HerbState.isRunning then ascendToFlyHeight();end if bestTarget then HerbState.collectedHerbs[bestTarget]=tick();end HerbState.currentHerb=nil;AuraState.currentAura=nil;task.wait(0.5);continue;else print("[主流程] 采集超时，当前超时次数："   .. HerbState.currentTimeoutCount );if (HerbState.currentTimeoutCount>=CONFIG.MAX_RETRY_ATTEMPTS) then print("[主流程] 达到最大超时次数（"   .. CONFIG.MAX_RETRY_ATTEMPTS   .. "），寻找替代目标..." );end local alternativeTarget,altIsAura=findAlternativeTarget(bestTarget,isAura);if alternativeTarget then print("[主流程] 切换到替代目标："   .. alternativeTarget.Name );if altIsAura then AuraState.currentAura=alternativeTarget;else HerbState.currentHerb=alternativeTarget;end if HerbState.isRunning then print("[主流程] 立即前往替代目标...");ascendToFlyHeight();end continue;else print("[主流程] 未找到替代目标");if (HerbState.currentTimeoutCount>=CONFIG.MAX_RETRY_ATTEMPTS) then print("[主流程] 连续超时次数过多，停止系统");HerbState.isRunning=false;break;else print("[主流程] 将在3秒后重新寻找目标");if HerbState.isRunning then ascendToFlyHeight();end task.wait(3);continue;end end end end disableFlight();HerbState.currentHerb=nil;AuraState.currentAura=nil;HerbState.retryAttempts=0;HerbState.currentTimeoutCount=0;HerbState.failCount=0;print("[主流程] 已停止");end local function startHerbSystem() if HerbState.isRunning then print("[系统] 系统已经在运行中");return false;end print("[系统] 正在启动系统...");HerbState.retryAttempts=0;HerbState.currentTimeoutCount=0;HerbState.collectedHerbs={};HerbState.timeoutHerbs={};HerbState.herbAgeCache={};HerbState.modifiedHerbs={};HerbState.failCount=0;HerbState.currentHerb=nil;AuraState.currentAura=nil;HerbState.IsFlying=false;HerbState.lastTargetTime=tick();HerbState.autoHarvestLastCollectTime=0;if HerbState.FlightBodyVelocity then HerbState.FlightBodyVelocity:Destroy();HerbState.FlightBodyVelocity=nil;end if HerbState.FlightBodyGyro then HerbState.FlightBodyGyro:Destroy();HerbState.FlightBodyGyro=nil;end if HerbState.FlightConnection then HerbState.FlightConnection:Disconnect();HerbState.FlightConnection=nil;end HerbState.isRunning=true;if HerbState.collisionEnabled then print("[系统] 启用碰撞禁用");disableAllCollisionInMap();end if HerbState.quickPickEnabled then print("[系统] 启用一键加速");setupQuickPickListener();end if HerbState.autoHarvestEnabled then print("[系统] 启用自动采摘");startAutoHarvest();end if HerbState.auraAutoCollectEnabled then print("[系统] 启用功法自动收集");toggleAuraAutoCollect();end print("[系统] 启动系统，当前目标模式: "   .. HerbState.targetMode );print("[系统] 自动采摘: "   .. ((HerbState.autoHarvestEnabled and "开启") or "关闭") );print("[系统] 一键加速: "   .. ((HerbState.quickPickEnabled and "开启") or "关闭") );print("[系统] 碰撞禁用: "   .. ((HerbState.collisionEnabled and "开启") or "关闭") );print("[系统] 功法自动收集: "   .. ((HerbState.auraAutoCollectEnabled and "开启") or "关闭") );task.spawn(function() mainLoop();end);print("[系统] 系统已成功启动");return true;end local function stopHerbSystem() if  not HerbState.isRunning then print("[系统] 系统未在运行");return false;end print("[系统] 正在停止系统...");HerbState.isRunning=false;StopAllMovement();HerbState.currentHerb=nil;AuraState.currentAura=nil;stopAutoHarvest();if AuraAutoCollectState.enabled then toggleAuraAutoCollect();end if HerbState.quickPickConnection then HerbState.quickPickConnection:Disconnect();HerbState.quickPickConnection=nil;end if CollisionState.isCollisionDisabled then print("[系统] 恢复地图碰撞");enableAllCollisionInMap();end HerbState.modifiedHerbs={};print("[系统] 系统已停止");return true;end local function loadHerbTypesFromReplicatedStorage() local herbsList={};local seenNames={};print("[草药列表] 从ReplicatedStorage.Models.Herbs文件夹加载...");local herbsFolder=ReplicatedStorage:FindFirstChild("Models");if herbsFolder then herbsFolder=herbsFolder:FindFirstChild("Herbs");end if herbsFolder then print("[草药列表] 找到ReplicatedStorage.Models.Herbs文件夹");for _,item in ipairs(herbsFolder:GetChildren()) do if  not item then continue;end local herbName=item.Name;local isBlacklisted=false;for _,blacklistName in ipairs(CONFIG.BLACKLIST_HERBS) do if ((herbName==blacklistName) or herbName:match(blacklistName)) then isBlacklisted=true;print("[草药列表] 跳过黑名单草药: "   .. herbName );break;end end if isBlacklisted then continue;end local isHerbObject=false;if (item:IsA("Model") or item:IsA("MeshPart") or item:IsA("Part")) then isHerbObject=true;end if (isHerbObject and  not seenNames[herbName]) then table.insert(herbsList,herbName);seenNames[herbName]=true;print("[草药列表] 添加草药: "   .. herbName );end end else print("[草药列表] 未找到ReplicatedStorage.Models.Herbs文件夹，使用默认列表");herbsList={"Extreme Yin Growth","Extreme Yang Growth","Yin Growth","Yang Growth","Spiritual Growth","Herbal Growth","Mystic Growth"};end table.sort(herbsList);HerbState.availableHerbTypes=herbsList;print("[草药列表] 已加载 "   ..  #herbsList   .. " 种草药类型" );return herbsList;end local PriorityUI=nil;local function createPrioritySelectionUI() if PriorityUI then PriorityUI:Destroy();PriorityUI=nil;HerbState.isPriorityUIOpen=false;return;end if HerbState.isPriorityUIOpen then print("[优先级] 优先级UI已打开");return;end print("[优先级] 创建优先级选择UI");local screenGui=Instance.new("ScreenGui");screenGui.Name="PrioritySelectionUI";screenGui.ResetOnSpawn=false;screenGui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;screenGui.DisplayOrder=20;local UI=CONFIG.UI_SCALE;local mainFrame=Instance.new("Frame");mainFrame.Name="MainFrame";mainFrame.Size=UDim2.new(0,UI.PRIORITY_FRAME_WIDTH,0,UI.PRIORITY_FRAME_HEIGHT);mainFrame.Position=UDim2.new(0.5, -UI.PRIORITY_FRAME_WIDTH/2 ,0.5, -UI.PRIORITY_FRAME_HEIGHT/2 );mainFrame.BackgroundColor3=Color3.fromRGB(40,40,60);mainFrame.BackgroundTransparency=0.1;mainFrame.BorderSizePixel=0;mainFrame.Active=true;mainFrame.Draggable=true;local titleLabel=Instance.new("TextLabel");titleLabel.Name="Title";titleLabel.Size=UDim2.new(1,0,0,40);titleLabel.Position=UDim2.new(0,0,0,0);titleLabel.BackgroundColor3=Color3.fromRGB(60,60,90);titleLabel.Text="优先级草药选择";titleLabel.TextColor3=Color3.fromRGB(255,255,255);titleLabel.Font=Enum.Font.SourceSansBold;titleLabel.TextSize=UI.TITLE_TEXT_SIZE;titleLabel.BorderSizePixel=0;local instructionLabel=Instance.new("TextLabel");instructionLabel.Name="Instruction";instructionLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,50);instructionLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,45);instructionLabel.BackgroundTransparency=1;instructionLabel.Text="选择优先级草药（最多"   .. CONFIG.MAX_PRIORITY_HERBS   .. "种）\n选择的顺序即为优先级顺序" ;instructionLabel.TextColor3=Color3.fromRGB(200,200,255);instructionLabel.Font=Enum.Font.SourceSans;instructionLabel.TextSize=UI.SMALL_TEXT_SIZE;instructionLabel.TextWrapped=true;instructionLabel.TextXAlignment=Enum.TextXAlignment.Left;local selectionLabel=Instance.new("TextLabel");selectionLabel.Name="SelectionLabel";selectionLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);selectionLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,100);selectionLabel.BackgroundTransparency=1;selectionLabel.Text="已选择: 0/"   .. CONFIG.MAX_PRIORITY_HERBS ;selectionLabel.TextColor3=Color3.fromRGB(200,255,200);selectionLabel.Font=Enum.Font.SourceSansBold;selectionLabel.TextSize=UI.BODY_TEXT_SIZE;selectionLabel.TextXAlignment=Enum.TextXAlignment.Left;local priorityFrame=Instance.new("Frame");priorityFrame.Name="PriorityFrame";priorityFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,120);priorityFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,130);priorityFrame.BackgroundColor3=Color3.fromRGB(50,50,70);priorityFrame.BorderSizePixel=0;local priorityTitle=Instance.new("TextLabel");priorityTitle.Name="PriorityTitle";priorityTitle.Size=UDim2.new(1,0,0,25);priorityTitle.Position=UDim2.new(0,0,0,0);priorityTitle.BackgroundColor3=Color3.fromRGB(70,70,100);priorityTitle.Text="优先级列表 (点击移除)";priorityTitle.TextColor3=Color3.fromRGB(255,255,255);priorityTitle.Font=Enum.Font.SourceSansBold;priorityTitle.TextSize=UI.BODY_TEXT_SIZE;priorityTitle.BorderSizePixel=0;local priorityScroll=Instance.new("ScrollingFrame");priorityScroll.Name="PriorityScroll";priorityScroll.Size=UDim2.new(1,0,1, -25);priorityScroll.Position=UDim2.new(0,0,0,25);priorityScroll.BackgroundTransparency=1;priorityScroll.BorderSizePixel=0;priorityScroll.ScrollBarThickness=8;priorityScroll.CanvasSize=UDim2.new(0,0,0,0);local herbsFrame=Instance.new("Frame");herbsFrame.Name="HerbsFrame";herbsFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,200);herbsFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,255);herbsFrame.BackgroundColor3=Color3.fromRGB(50,50,70);herbsFrame.BorderSizePixel=0;local herbsTitle=Instance.new("TextLabel");herbsTitle.Name="HerbsTitle";herbsTitle.Size=UDim2.new(1,0,0,25);herbsTitle.Position=UDim2.new(0,0,0,0);herbsTitle.BackgroundColor3=Color3.fromRGB(70,70,100);herbsTitle.Text="草药列表 (点击选择)";herbsTitle.TextColor3=Color3.fromRGB(255,255,255);herbsTitle.Font=Enum.Font.SourceSansBold;herbsTitle.TextSize=UI.BODY_TEXT_SIZE;herbsTitle.BorderSizePixel=0;local herbsScroll=Instance.new("ScrollingFrame");herbsScroll.Name="HerbsScroll";herbsScroll.Size=UDim2.new(1,0,1, -25);herbsScroll.Position=UDim2.new(0,0,0,25);herbsScroll.BackgroundTransparency=1;herbsScroll.BorderSizePixel=0;herbsScroll.ScrollBarThickness=8;herbsScroll.CanvasSize=UDim2.new(0,0,0,0);local buttonFrame=Instance.new("Frame");buttonFrame.Name="ButtonFrame";buttonFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,50);buttonFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,UI.PRIORITY_FRAME_HEIGHT-60 );buttonFrame.BackgroundTransparency=1;buttonFrame.BorderSizePixel=0;local confirmButton=Instance.new("TextButton");confirmButton.Name="ConfirmButton";confirmButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);confirmButton.Position=UDim2.new(0.025,0,0,5);confirmButton.BackgroundColor3=Color3.fromRGB(50,150,50);confirmButton.Text="确认";confirmButton.TextColor3=Color3.fromRGB(255,255,255);confirmButton.Font=Enum.Font.SourceSansBold;confirmButton.TextSize=UI.BUTTON_TEXT_SIZE;confirmButton.BorderSizePixel=0;local cancelButton=Instance.new("TextButton");cancelButton.Name="CancelButton";cancelButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);cancelButton.Position=UDim2.new(0.525,0,0,5);cancelButton.BackgroundColor3=Color3.fromRGB(200,50,50);cancelButton.Text="取消";cancelButton.TextColor3=Color3.fromRGB(255,255,255);cancelButton.Font=Enum.Font.SourceSans;cancelButton.TextSize=UI.BUTTON_TEXT_SIZE;cancelButton.BorderSizePixel=0;local clearButton=Instance.new("TextButton");clearButton.Name="ClearButton";clearButton.Size=UDim2.new(0.45,0,0,28);clearButton.Position=UDim2.new(0.275,0,0,UI.BUTTON_HEIGHT + 10 );clearButton.BackgroundColor3=Color3.fromRGB(150,150,150);clearButton.Text="清空选择";clearButton.TextColor3=Color3.fromRGB(255,255,255);clearButton.Font=Enum.Font.SourceSans;clearButton.TextSize=UI.SMALL_TEXT_SIZE;clearButton.BorderSizePixel=0;local selectedHerbs={};local selectedCount=0;local function updateSelectionDisplay() selectionLabel.Text=string.format("已选择: %d/%d",selectedCount,CONFIG.MAX_PRIORITY_HERBS);if (selectedCount>=CONFIG.MAX_PRIORITY_HERBS) then selectionLabel.TextColor3=Color3.fromRGB(255,100,100);selectionLabel.Text=selectionLabel.Text   .. " (已达上限)" ;else selectionLabel.TextColor3=Color3.fromRGB(200,255,200);end end local function createPriorityItem(index,herbName) local itemFrame=Instance.new("TextButton");itemFrame.Name="PriorityItem_"   .. index ;itemFrame.Size=UDim2.new(1, -10,0,30);itemFrame.Position=UDim2.new(0,5,0,(index-1) * 32 );itemFrame.BackgroundColor3=Color3.fromRGB(70,70,100);itemFrame.Text="";itemFrame.BorderSizePixel=0;local layout=Instance.new("UIListLayout");layout.FillDirection=Enum.FillDirection.Horizontal;layout.HorizontalAlignment=Enum.HorizontalAlignment.Left;layout.VerticalAlignment=Enum.VerticalAlignment.Center;layout.SortOrder=Enum.SortOrder.LayoutOrder;layout.Padding=UDim.new(0,8);layout.Parent=itemFrame;local priorityLabel=Instance.new("TextLabel");priorityLabel.Name="Priority";priorityLabel.Size=UDim2.new(0,40,1,0);priorityLabel.LayoutOrder=1;priorityLabel.BackgroundTransparency=1;priorityLabel.Text="#"   .. index ;priorityLabel.TextColor3=Color3.fromRGB(255,215,0);priorityLabel.Font=Enum.Font.SourceSansBold;priorityLabel.TextSize=14;priorityLabel.TextXAlignment=Enum.TextXAlignment.Center;local nameLabel=Instance.new("TextLabel");nameLabel.Name="Name";nameLabel.Size=UDim2.new(1, -50,1,0);nameLabel.LayoutOrder=2;nameLabel.BackgroundTransparency=1;nameLabel.Text=herbName;nameLabel.TextColor3=Color3.fromRGB(255,255,255);nameLabel.Font=Enum.Font.SourceSans;nameLabel.TextSize=14;nameLabel.TextXAlignment=Enum.TextXAlignment.Left;nameLabel.TextTruncate=Enum.TextTruncate.AtEnd;itemFrame.MouseButton1Click:Connect(function() for idx,name in ipairs(selectedHerbs) do if (name==herbName) then table.remove(selectedHerbs,idx);selectedCount=selectedCount-1 ;break;end end for _,child in ipairs(priorityScroll:GetChildren()) do if (child:IsA("Frame") or child:IsA("TextButton")) then child:Destroy();end end for i,name in ipairs(selectedHerbs) do createPriorityItem(i,name);end for _,child in ipairs(herbsScroll:GetChildren()) do if (child:IsA("Frame") or child:IsA("TextButton")) then local nameLabel=child:FindFirstChild("Name");if nameLabel then local isSelected=false;for _,selectedName in ipairs(selectedHerbs) do if (selectedName==nameLabel.Text) then isSelected=true;break;end end local checkmark=child:FindFirstChild("Checkmark");if checkmark then checkmark.Visible=isSelected;end child.BackgroundColor3=(isSelected and Color3.fromRGB(80,120,80)) or Color3.fromRGB(60,60,80) ;end end end updateSelectionDisplay();print("[优先级] 已移除草药: "   .. herbName );end);priorityLabel.Parent=itemFrame;nameLabel.Parent=itemFrame;itemFrame.Parent=priorityScroll;return itemFrame;end local function updatePriorityList() for _,child in ipairs(priorityScroll:GetChildren()) do if (child:IsA("Frame") or child:IsA("TextButton")) then child:Destroy();end end for i,herbName in ipairs(selectedHerbs) do createPriorityItem(i,herbName);end priorityScroll.CanvasSize=UDim2.new(0,0,0, #selectedHerbs * 32 );end local herbsList=loadHerbTypesFromReplicatedStorage();for _,priorityHerb in ipairs(HerbState.priorityHerbs) do table.insert(selectedHerbs,priorityHerb.name);selectedCount=selectedCount + 1 ;end for i,herbName in ipairs(herbsList) do local itemFrame=Instance.new("TextButton");itemFrame.Name="HerbItem_"   .. i ;itemFrame.Size=UDim2.new(1, -10,0,UI.HERB_ITEM_HEIGHT);itemFrame.Position=UDim2.new(0,5,0,(i-1) * (UI.HERB_ITEM_HEIGHT + 2) );itemFrame.BackgroundColor3=Color3.fromRGB(60,60,80);itemFrame.Text="";itemFrame.BorderSizePixel=0;local layout=Instance.new("UIListLayout");layout.FillDirection=Enum.FillDirection.Horizontal;layout.HorizontalAlignment=Enum.HorizontalAlignment.Left;layout.VerticalAlignment=Enum.VerticalAlignment.Center;layout.SortOrder=Enum.SortOrder.LayoutOrder;layout.Padding=UDim.new(0,8);layout.Parent=itemFrame;local checkbox=Instance.new("Frame");checkbox.Name="Checkbox";checkbox.Size=UDim2.new(0,24,0,24);checkbox.LayoutOrder=1;checkbox.BackgroundColor3=Color3.fromRGB(80,80,100);checkbox.BorderSizePixel=0;local checkmark=Instance.new("TextLabel");checkmark.Name="Checkmark";checkmark.Size=UDim2.new(1,0,1,0);checkmark.Position=UDim2.new(0,0,0,0);checkmark.BackgroundTransparency=1;checkmark.Text="✓";checkmark.TextColor3=Color3.fromRGB(100,255,100);checkmark.Font=Enum.Font.SourceSansBold;checkmark.TextSize=18;checkmark.Visible=false;local nameLabel=Instance.new("TextLabel");nameLabel.Name="Name";nameLabel.Size=UDim2.new(1, -30,1,0);nameLabel.LayoutOrder=2;nameLabel.BackgroundTransparency=1;nameLabel.Text=herbName;nameLabel.TextColor3=Color3.fromRGB(255,255,255);nameLabel.Font=Enum.Font.SourceSans;nameLabel.TextSize=UI.BODY_TEXT_SIZE;nameLabel.TextXAlignment=Enum.TextXAlignment.Left;nameLabel.TextTruncate=Enum.TextTruncate.AtEnd;local isSelected=false;for _,selectedName in ipairs(selectedHerbs) do if (selectedName==herbName) then isSelected=true;checkmark.Visible=true;itemFrame.BackgroundColor3=Color3.fromRGB(80,120,80);checkbox.BackgroundColor3=Color3.fromRGB(100,150,100);break;end end itemFrame.MouseButton1Click:Connect(function() if isSelected then isSelected=false;checkmark.Visible=false;itemFrame.BackgroundColor3=Color3.fromRGB(60,60,80);checkbox.BackgroundColor3=Color3.fromRGB(80,80,100);for idx,name in ipairs(selectedHerbs) do if (name==herbName) then table.remove(selectedHerbs,idx);selectedCount=selectedCount-1 ;break;end end print("[优先级] 已取消选择草药: "   .. herbName );else if (selectedCount>=CONFIG.MAX_PRIORITY_HERBS) then print("[优先级] 已达到最大选择数量 ("   .. CONFIG.MAX_PRIORITY_HERBS   .. ")，无法选择更多草药" );return;end isSelected=true;checkmark.Visible=true;itemFrame.BackgroundColor3=Color3.fromRGB(80,120,80);checkbox.BackgroundColor3=Color3.fromRGB(100,150,100);table.insert(selectedHerbs,herbName);selectedCount=selectedCount + 1 ;print("[优先级] 已选择草药: "   .. herbName   .. " (优先级: "   .. selectedCount   .. ")" );end updatePriorityList();updateSelectionDisplay();end);checkmark.Parent=checkbox;checkbox.Parent=itemFrame;nameLabel.Parent=itemFrame;itemFrame.Parent=herbsScroll;end herbsScroll.CanvasSize=UDim2.new(0,0,0, #herbsList * (UI.HERB_ITEM_HEIGHT + 2) );confirmButton.MouseButton1Click:Connect(function() HerbState.priorityHerbs={};for i,herbName in ipairs(selectedHerbs) do table.insert(HerbState.priorityHerbs,{name=herbName,priority=i});end print("[优先级] 已保存 "   ..  #HerbState.priorityHerbs   .. " 种优先级草药" );for _,priorityHerb in ipairs(HerbState.priorityHerbs) do print(string.format("[优先级] 优先级%d: %s",priorityHerb.priority,priorityHerb.name));end screenGui:Destroy();PriorityUI=nil;HerbState.isPriorityUIOpen=false;end);cancelButton.MouseButton1Click:Connect(function() screenGui:Destroy();PriorityUI=nil;HerbState.isPriorityUIOpen=false;print("[优先级] 已取消选择");end);clearButton.MouseButton1Click:Connect(function() selectedHerbs={};selectedCount=0;for _,child in ipairs(herbsScroll:GetChildren()) do if child:IsA("TextButton") then child.BackgroundColor3=Color3.fromRGB(60,60,80);local checkbox=child:FindFirstChild("Checkbox");if checkbox then checkbox.BackgroundColor3=Color3.fromRGB(80,80,100);local checkmark=checkbox:FindFirstChild("Checkmark");if checkmark then checkmark.Visible=false;end end end end updatePriorityList();updateSelectionDisplay();print("[优先级] 已清空所有选择");end);screenGui.Destroying:Connect(function() HerbState.isPriorityUIOpen=false;PriorityUI=nil;end);updatePriorityList();updateSelectionDisplay();priorityTitle.Parent=priorityFrame;priorityScroll.Parent=priorityFrame;herbsTitle.Parent=herbsFrame;herbsScroll.Parent=herbsFrame;titleLabel.Parent=mainFrame;instructionLabel.Parent=mainFrame;selectionLabel.Parent=mainFrame;priorityFrame.Parent=mainFrame;herbsFrame.Parent=mainFrame;confirmButton.Parent=buttonFrame;cancelButton.Parent=buttonFrame;clearButton.Parent=buttonFrame;buttonFrame.Parent=mainFrame;mainFrame.Parent=screenGui;screenGui.Parent=player:WaitForChild("PlayerGui");PriorityUI=screenGui;HerbState.isPriorityUIOpen=true;return screenGui;end local PillUI=nil;local function createPillUI() if PillUI then PillUI:Destroy();PillUI=nil;PillState.isPillUIOpen=false;return;end if PillState.isPillUIOpen then print("[炼药] 炼药UI已打开");return;end print("[炼药] 创建炼药设置UI");local screenGui=Instance.new("ScreenGui");screenGui.Name="PillSettingUI";screenGui.ResetOnSpawn=false;screenGui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;screenGui.DisplayOrder=20;local UI=CONFIG.UI_SCALE;local mainFrame=Instance.new("Frame");mainFrame.Name="MainFrame";mainFrame.Size=UDim2.new(0,500,0,550);mainFrame.Position=UDim2.new(0.5, -250,0.5, -275);mainFrame.BackgroundColor3=Color3.fromRGB(40,40,60);mainFrame.BackgroundTransparency=0.1;mainFrame.BorderSizePixel=0;mainFrame.Active=true;mainFrame.Draggable=true;local titleLabel=Instance.new("TextLabel");titleLabel.Name="Title";titleLabel.Size=UDim2.new(1,0,0,40);titleLabel.Position=UDim2.new(0,0,0,0);titleLabel.BackgroundColor3=Color3.fromRGB(60,60,90);titleLabel.Text="炼药设置";titleLabel.TextColor3=Color3.fromRGB(255,255,255);titleLabel.Font=Enum.Font.SourceSansBold;titleLabel.TextSize=UI.TITLE_TEXT_SIZE;titleLabel.BorderSizePixel=0;local instructionLabel=Instance.new("TextLabel");instructionLabel.Name="Instruction";instructionLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,50);instructionLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,45);instructionLabel.BackgroundTransparency=1;instructionLabel.Text="选择丹药类型并设置炼制次数和间隔";instructionLabel.TextColor3=Color3.fromRGB(200,200,255);instructionLabel.Font=Enum.Font.SourceSans;instructionLabel.TextSize=UI.SMALL_TEXT_SIZE;instructionLabel.TextWrapped=true;instructionLabel.TextXAlignment=Enum.TextXAlignment.Left;local currentSelectionLabel=Instance.new("TextLabel");currentSelectionLabel.Name="CurrentSelectionLabel";currentSelectionLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);currentSelectionLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,100);currentSelectionLabel.BackgroundTransparency=1;currentSelectionLabel.Text="当前选择: "   .. PillState.currentPillType ;currentSelectionLabel.TextColor3=Color3.fromRGB(100,255,100);currentSelectionLabel.Font=Enum.Font.SourceSansBold;currentSelectionLabel.TextSize=UI.BODY_TEXT_SIZE;currentSelectionLabel.TextXAlignment=Enum.TextXAlignment.Left;local countLabel=Instance.new("TextLabel");countLabel.Name="CountLabel";countLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);countLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,130);countLabel.BackgroundTransparency=1;countLabel.Text="炼制次数: "   .. PillState.craftCount ;countLabel.TextColor3=Color3.fromRGB(200,255,200);countLabel.Font=Enum.Font.SourceSansBold;countLabel.TextSize=UI.BODY_TEXT_SIZE;countLabel.TextXAlignment=Enum.TextXAlignment.Left;local countFrame=Instance.new("Frame");countFrame.Name="CountFrame";countFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,UI.BUTTON_HEIGHT);countFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,160);countFrame.BackgroundColor3=Color3.fromRGB(50,50,70);countFrame.BorderSizePixel=0;local countTextBox=Instance.new("TextBox");countTextBox.Name="CountTextBox";countTextBox.Size=UDim2.new(0.7,0,1,0);countTextBox.Position=UDim2.new(0,0,0,0);countTextBox.BackgroundColor3=Color3.fromRGB(80,80,100);countTextBox.TextColor3=Color3.fromRGB(255,255,255);countTextBox.Font=Enum.Font.SourceSans;countTextBox.Text=tostring(PillState.craftCount);countTextBox.TextSize=UI.BUTTON_TEXT_SIZE;countTextBox.BorderSizePixel=0;countTextBox.PlaceholderText="输入炼制次数 (1-1000)";local countApplyButton=Instance.new("TextButton");countApplyButton.Name="CountApplyButton";countApplyButton.Size=UDim2.new(0.3,0,1,0);countApplyButton.Position=UDim2.new(0.7,0,0,0);countApplyButton.BackgroundColor3=Color3.fromRGB(70,120,70);countApplyButton.Text="应用";countApplyButton.TextColor3=Color3.fromRGB(255,255,255);countApplyButton.Font=Enum.Font.SourceSansBold;countApplyButton.TextSize=UI.BUTTON_TEXT_SIZE;countApplyButton.BorderSizePixel=0;local intervalLabel=Instance.new("TextLabel");intervalLabel.Name="IntervalLabel";intervalLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);intervalLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,205);intervalLabel.BackgroundTransparency=1;intervalLabel.Text="炼药间隔: "   .. PillState.craftInterval   .. "秒" ;intervalLabel.TextColor3=Color3.fromRGB(200,255,200);intervalLabel.Font=Enum.Font.SourceSansBold;intervalLabel.TextSize=UI.BODY_TEXT_SIZE;intervalLabel.TextXAlignment=Enum.TextXAlignment.Left;local intervalFrame=Instance.new("Frame");intervalFrame.Name="IntervalFrame";intervalFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,UI.BUTTON_HEIGHT);intervalFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,235);intervalFrame.BackgroundColor3=Color3.fromRGB(50,50,70);intervalFrame.BorderSizePixel=0;local intervalTextBox=Instance.new("TextBox");intervalTextBox.Name="IntervalTextBox";intervalTextBox.Size=UDim2.new(0.7,0,1,0);intervalTextBox.Position=UDim2.new(0,0,0,0);intervalTextBox.BackgroundColor3=Color3.fromRGB(80,80,100);intervalTextBox.TextColor3=Color3.fromRGB(255,255,255);intervalTextBox.Font=Enum.Font.SourceSans;intervalTextBox.Text=tostring(PillState.craftInterval);intervalTextBox.TextSize=UI.BUTTON_TEXT_SIZE;intervalTextBox.BorderSizePixel=0;intervalTextBox.PlaceholderText="输入炼药间隔秒数 (1-60)";local intervalApplyButton=Instance.new("TextButton");intervalApplyButton.Name="IntervalApplyButton";intervalApplyButton.Size=UDim2.new(0.3,0,1,0);intervalApplyButton.Position=UDim2.new(0.7,0,0,0);intervalApplyButton.BackgroundColor3=Color3.fromRGB(70,120,70);intervalApplyButton.Text="应用";intervalApplyButton.TextColor3=Color3.fromRGB(255,255,255);intervalApplyButton.Font=Enum.Font.SourceSansBold;intervalApplyButton.TextSize=UI.BUTTON_TEXT_SIZE;intervalApplyButton.BorderSizePixel=0;local pillsFrame=Instance.new("Frame");pillsFrame.Name="PillsFrame";pillsFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,200);pillsFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,280);pillsFrame.BackgroundColor3=Color3.fromRGB(50,50,70);pillsFrame.BorderSizePixel=0;local pillsTitle=Instance.new("TextLabel");pillsTitle.Name="PillsTitle";pillsTitle.Size=UDim2.new(1,0,0,25);pillsTitle.Position=UDim2.new(0,0,0,0);pillsTitle.BackgroundColor3=Color3.fromRGB(70,70,100);pillsTitle.Text="丹药列表 (点击选择)";pillsTitle.TextColor3=Color3.fromRGB(255,255,255);pillsTitle.Font=Enum.Font.SourceSansBold;pillsTitle.TextSize=UI.BODY_TEXT_SIZE;pillsTitle.BorderSizePixel=0;local pillsScroll=Instance.new("ScrollingFrame");pillsScroll.Name="PillsScroll";pillsScroll.Size=UDim2.new(1,0,1, -25);pillsScroll.Position=UDim2.new(0,0,0,25);pillsScroll.BackgroundTransparency=1;pillsScroll.BorderSizePixel=0;pillsScroll.ScrollBarThickness=8;pillsScroll.CanvasSize=UDim2.new(0,0,0,0);local buttonFrame=Instance.new("Frame");buttonFrame.Name="ButtonFrame";buttonFrame.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,50);buttonFrame.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,485);buttonFrame.BackgroundTransparency=1;buttonFrame.BorderSizePixel=0;local startButton=Instance.new("TextButton");startButton.Name="StartButton";startButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);startButton.Position=UDim2.new(0.025,0,0,5);startButton.BackgroundColor3=Color3.fromRGB(50,150,50);startButton.Text="开始炼药";startButton.TextColor3=Color3.fromRGB(255,255,255);startButton.Font=Enum.Font.SourceSansBold;startButton.TextSize=UI.BUTTON_TEXT_SIZE;startButton.BorderSizePixel=0;local onceButton=Instance.new("TextButton");onceButton.Name="OnceButton";onceButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);onceButton.Position=UDim2.new(0.525,0,0,5);onceButton.BackgroundColor3=Color3.fromRGB(150,150,50);onceButton.Text="单次炼药";onceButton.TextColor3=Color3.fromRGB(255,255,255);onceButton.Font=Enum.Font.SourceSans;onceButton.TextSize=UI.BUTTON_TEXT_SIZE;onceButton.BorderSizePixel=0;local closeButton=Instance.new("TextButton");closeButton.Name="CloseButton";closeButton.Size=UDim2.new(0.45,0,0,28);closeButton.Position=UDim2.new(0.275,0,0,UI.BUTTON_HEIGHT + 10 );closeButton.BackgroundColor3=Color3.fromRGB(200,50,50);closeButton.Text="关闭";closeButton.TextColor3=Color3.fromRGB(255,255,255);closeButton.Font=Enum.Font.SourceSans;closeButton.TextSize=UI.SMALL_TEXT_SIZE;closeButton.BorderSizePixel=0;local function createPillList() for i,pillType in ipairs(CONFIG.PILL_TYPES) do local itemFrame=Instance.new("TextButton");itemFrame.Name="PillItem_"   .. i ;itemFrame.Size=UDim2.new(1, -10,0,UI.HERB_ITEM_HEIGHT);itemFrame.Position=UDim2.new(0,5,0,(i-1) * (UI.HERB_ITEM_HEIGHT + 2) );itemFrame.BackgroundColor3=((pillType==PillState.currentPillType) and Color3.fromRGB(80,120,80)) or Color3.fromRGB(60,60,80) ;itemFrame.Text="";itemFrame.BorderSizePixel=0;local layout=Instance.new("UIListLayout");layout.FillDirection=Enum.FillDirection.Horizontal;layout.HorizontalAlignment=Enum.HorizontalAlignment.Left;layout.VerticalAlignment=Enum.VerticalAlignment.Center;layout.SortOrder=Enum.SortOrder.LayoutOrder;layout.Padding=UDim.new(0,8);layout.Parent=itemFrame;local checkbox=Instance.new("Frame");checkbox.Name="Checkbox";checkbox.Size=UDim2.new(0,24,0,24);checkbox.LayoutOrder=1;checkbox.BackgroundColor3=((pillType==PillState.currentPillType) and Color3.fromRGB(100,150,100)) or Color3.fromRGB(80,80,100) ;checkbox.BorderSizePixel=0;local checkmark=Instance.new("TextLabel");checkmark.Name="Checkmark";checkmark.Size=UDim2.new(1,0,1,0);checkmark.Position=UDim2.new(0,0,0,0);checkmark.BackgroundTransparency=1;checkmark.Text="✓";checkmark.TextColor3=Color3.fromRGB(100,255,100);checkmark.Font=Enum.Font.SourceSansBold;checkmark.TextSize=18;checkmark.Visible=pillType==PillState.currentPillType ;local nameLabel=Instance.new("TextLabel");nameLabel.Name="Name";nameLabel.Size=UDim2.new(1, -30,1,0);nameLabel.LayoutOrder=2;nameLabel.BackgroundTransparency=1;nameLabel.Text=pillType;nameLabel.TextColor3=Color3.fromRGB(255,255,255);nameLabel.Font=Enum.Font.SourceSans;nameLabel.TextSize=UI.BODY_TEXT_SIZE;nameLabel.TextXAlignment=Enum.TextXAlignment.Left;nameLabel.TextTruncate=Enum.TextTruncate.AtEnd;itemFrame.MouseButton1Click:Connect(function() PillState.currentPillType=pillType;currentSelectionLabel.Text="当前选择: "   .. pillType ;for _,child in ipairs(pillsScroll:GetChildren()) do if child:IsA("TextButton") then local childNameLabel=child:FindFirstChild("Name");if childNameLabel then if (childNameLabel.Text==pillType) then child.BackgroundColor3=Color3.fromRGB(80,120,80);local checkbox=child:FindFirstChild("Checkbox");if checkbox then checkbox.BackgroundColor3=Color3.fromRGB(100,150,100);local checkmark=checkbox:FindFirstChild("Checkmark");if checkmark then checkmark.Visible=true;end end else child.BackgroundColor3=Color3.fromRGB(60,60,80);local checkbox=child:FindFirstChild("Checkbox");if checkbox then checkbox.BackgroundColor3=Color3.fromRGB(80,80,100);local checkmark=checkbox:FindFirstChild("Checkmark");if checkmark then checkmark.Visible=false;end end end end end end print("[炼药] 选择丹药: "   .. pillType );end);checkmark.Parent=checkbox;checkbox.Parent=itemFrame;nameLabel.Parent=itemFrame;itemFrame.Parent=pillsScroll;end pillsScroll.CanvasSize=UDim2.new(0,0,0, #CONFIG.PILL_TYPES * (UI.HERB_ITEM_HEIGHT + 2) );end createPillList();countApplyButton.MouseButton1Click:Connect(function() local count=tonumber(countTextBox.Text) or 1 ;count=math.max(1,math.min(1000,count));PillState.craftCount=count;countTextBox.Text=tostring(count);countLabel.Text="炼制次数: "   .. count ;print("[炼药] 设置炼制次数: "   .. count );end);countTextBox.FocusLost:Connect(function() local count=tonumber(countTextBox.Text) or 1 ;count=math.max(1,math.min(1000,count));PillState.craftCount=count;countTextBox.Text=tostring(count);countLabel.Text="炼制次数: "   .. count ;print("[炼药] 设置炼制次数: "   .. count );end);intervalApplyButton.MouseButton1Click:Connect(function() local interval=tonumber(intervalTextBox.Text) or 3 ;interval=math.max(0.5,math.min(60,interval));PillState.craftInterval=interval;intervalTextBox.Text=tostring(interval);intervalLabel.Text="炼药间隔: "   .. interval   .. "秒" ;print("[炼药] 设置炼药间隔: "   .. interval   .. "秒" );end);intervalTextBox.FocusLost:Connect(function() local interval=tonumber(intervalTextBox.Text) or 3 ;interval=math.max(0.5,math.min(60,interval));PillState.craftInterval=interval;intervalTextBox.Text=tostring(interval);intervalLabel.Text="炼药间隔: "   .. interval   .. "秒" ;print("[炼药] 设置炼药间隔: "   .. interval   .. "秒" );end);startButton.MouseButton1Click:Connect(function() local count=tonumber(countTextBox.Text) or 1 ;local interval=tonumber(intervalTextBox.Text) or 3 ;count=math.max(1,math.min(1000,count));interval=math.max(0.5,math.min(60,interval));PillState.craftCount=count;PillState.craftInterval=interval;if startCraftPills(PillState.currentPillType,count) then print("[炼药] 开始批量炼药");screenGui:Destroy();PillUI=nil;PillState.isPillUIOpen=false;end end);onceButton.MouseButton1Click:Connect(function() if craftSinglePill(PillState.currentPillType) then print("[炼药] 单次炼药完成");screenGui:Destroy();PillUI=nil;PillState.isPillUIOpen=false;end end);closeButton.MouseButton1Click:Connect(function() screenGui:Destroy();PillUI=nil;PillState.isPillUIOpen=false;print("[炼药] 关闭炼药设置");end);screenGui.Destroying:Connect(function() PillState.isPillUIOpen=false;PillUI=nil;end);titleLabel.Parent=mainFrame;instructionLabel.Parent=mainFrame;currentSelectionLabel.Parent=mainFrame;countLabel.Parent=mainFrame;countFrame.Parent=mainFrame;intervalLabel.Parent=mainFrame;intervalFrame.Parent=mainFrame;pillsFrame.Parent=mainFrame;countTextBox.Parent=countFrame;countApplyButton.Parent=countFrame;intervalTextBox.Parent=intervalFrame;intervalApplyButton.Parent=intervalFrame;pillsTitle.Parent=pillsFrame;pillsScroll.Parent=pillsFrame;startButton.Parent=buttonFrame;onceButton.Parent=buttonFrame;closeButton.Parent=buttonFrame;buttonFrame.Parent=mainFrame;mainFrame.Parent=screenGui;screenGui.Parent=player:WaitForChild("PlayerGui");PillUI=screenGui;PillState.isPillUIOpen=true;return screenGui;end local MainUI=nil;local CurrentTab="herb";local UIUpdateConnection=nil;local function createMainUI() if MainUI then MainUI:Destroy();MainUI=nil;end if UIUpdateConnection then UIUpdateConnection:Disconnect();UIUpdateConnection=nil;end local screenGui=Instance.new("ScreenGui");screenGui.Name="HerbCultivationUI";screenGui.ResetOnSpawn=false;screenGui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;screenGui.DisplayOrder=10;screenGui.Enabled=true;local UI=CONFIG.UI_SCALE;local mainFrame=Instance.new("Frame");mainFrame.Name="MainFrame";mainFrame.Size=UDim2.new(0,UI.MAIN_FRAME_WIDTH,0,UI.MAIN_FRAME_HEIGHT);mainFrame.Position=UDim2.new(0.02,0,0.02,0);mainFrame.BackgroundColor3=Color3.fromRGB(40,40,60);mainFrame.BackgroundTransparency=0.1;mainFrame.BorderSizePixel=0;mainFrame.Active=true;mainFrame.Draggable=true;local titleLabel=Instance.new("TextLabel");titleLabel.Name="Title";titleLabel.Size=UDim2.new(1,0,0,35);titleLabel.Position=UDim2.new(0,0,0,0);titleLabel.BackgroundColor3=Color3.fromRGB(60,60,90);titleLabel.Text="多功能采集系统";titleLabel.TextColor3=Color3.fromRGB(255,255,255);titleLabel.Font=Enum.Font.SourceSansBold;titleLabel.TextSize=UI.TITLE_TEXT_SIZE;titleLabel.BorderSizePixel=0;local tabFrame=Instance.new("Frame");tabFrame.Name="TabFrame";tabFrame.Size=UDim2.new(0,UI.TAB_BUTTON_WIDTH + (UI.PADDING_SMALL * 2) ,1, -35);tabFrame.Position=UDim2.new(0,0,0,35);tabFrame.BackgroundColor3=Color3.fromRGB(50,50,70);tabFrame.BorderSizePixel=0;local contentFrame=Instance.new("Frame");contentFrame.Name="ContentFrame";contentFrame.Size=UDim2.new(1, -(UI.TAB_BUTTON_WIDTH + (UI.PADDING_SMALL * 2)),1, -35);contentFrame.Position=UDim2.new(0,UI.TAB_BUTTON_WIDTH + (UI.PADDING_SMALL * 2) ,0,35);contentFrame.BackgroundColor3=Color3.fromRGB(45,45,65);contentFrame.BorderSizePixel=0;local herbTabButton=Instance.new("TextButton");herbTabButton.Name="HerbTabButton";herbTabButton.Size=UDim2.new(1, -UI.PADDING_SMALL * 2 ,0,UI.TAB_BUTTON_HEIGHT);herbTabButton.Position=UDim2.new(0,UI.PADDING_SMALL,0,UI.PADDING_SMALL);herbTabButton.BackgroundColor3=Color3.fromRGB(70,70,150);herbTabButton.Text="草药系统";herbTabButton.TextColor3=Color3.fromRGB(255,255,255);herbTabButton.Font=Enum.Font.SourceSansBold;herbTabButton.TextSize=UI.BODY_TEXT_SIZE;herbTabButton.BorderSizePixel=0;local auraTabButton=Instance.new("TextButton");auraTabButton.Name="AuraTabButton";auraTabButton.Size=UDim2.new(1, -UI.PADDING_SMALL * 2 ,0,UI.TAB_BUTTON_HEIGHT);auraTabButton.Position=UDim2.new(0,UI.PADDING_SMALL,0,UI.TAB_BUTTON_HEIGHT + (UI.PADDING_SMALL * 2) );auraTabButton.BackgroundColor3=Color3.fromRGB(150,100,70);auraTabButton.Text="功法系统";auraTabButton.TextColor3=Color3.fromRGB(255,255,255);auraTabButton.Font=Enum.Font.SourceSansBold;auraTabButton.TextSize=UI.BODY_TEXT_SIZE;auraTabButton.BorderSizePixel=0;local cultTabButton=Instance.new("TextButton");cultTabButton.Name="CultTabButton";cultTabButton.Size=UDim2.new(1, -UI.PADDING_SMALL * 2 ,0,UI.TAB_BUTTON_HEIGHT);cultTabButton.Position=UDim2.new(0,UI.PADDING_SMALL,0,(UI.TAB_BUTTON_HEIGHT * 2) + (UI.PADDING_SMALL * 3) );cultTabButton.BackgroundColor3=Color3.fromRGB(60,90,60);cultTabButton.Text="修炼系统";cultTabButton.TextColor3=Color3.fromRGB(255,255,255);cultTabButton.Font=Enum.Font.SourceSansBold;cultTabButton.TextSize=UI.BODY_TEXT_SIZE;cultTabButton.BorderSizePixel=0;local pillTabButton=Instance.new("TextButton");pillTabButton.Name="PillTabButton";pillTabButton.Size=UDim2.new(1, -UI.PADDING_SMALL * 2 ,0,UI.TAB_BUTTON_HEIGHT);pillTabButton.Position=UDim2.new(0,UI.PADDING_SMALL,0,(UI.TAB_BUTTON_HEIGHT * 3) + (UI.PADDING_SMALL * 4) );pillTabButton.BackgroundColor3=Color3.fromRGB(150,70,70);pillTabButton.Text="炼药系统";pillTabButton.TextColor3=Color3.fromRGB(255,255,255);pillTabButton.Font=Enum.Font.SourceSansBold;pillTabButton.TextSize=UI.BODY_TEXT_SIZE;pillTabButton.BorderSizePixel=0;local herbContentFrame=Instance.new("Frame");herbContentFrame.Name="HerbContentFrame";herbContentFrame.Size=UDim2.new(1,0,1,0);herbContentFrame.Position=UDim2.new(0,0,0,0);herbContentFrame.BackgroundTransparency=1;herbContentFrame.Visible=true;local auraContentFrame=Instance.new("Frame");auraContentFrame.Name="AuraContentFrame";auraContentFrame.Size=UDim2.new(1,0,1,0);auraContentFrame.Position=UDim2.new(0,0,0,0);auraContentFrame.BackgroundTransparency=1;auraContentFrame.Visible=false;local cultContentFrame=Instance.new("Frame");cultContentFrame.Name="CultContentFrame";cultContentFrame.Size=UDim2.new(1,0,1,0);cultContentFrame.Position=UDim2.new(0,0,0,0);cultContentFrame.BackgroundTransparency=1;cultContentFrame.Visible=false;local pillContentFrame=Instance.new("Frame");pillContentFrame.Name="PillContentFrame";pillContentFrame.Size=UDim2.new(1,0,1,0);pillContentFrame.Position=UDim2.new(0,0,0,0);pillContentFrame.BackgroundTransparency=1;pillContentFrame.Visible=false;local herbStatusLabel=Instance.new("TextLabel");herbStatusLabel.Name="HerbStatusLabel";herbStatusLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);herbStatusLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,10);herbStatusLabel.BackgroundTransparency=1;herbStatusLabel.Text="状态: 停止";herbStatusLabel.TextColor3=Color3.fromRGB(255,100,100);herbStatusLabel.Font=Enum.Font.SourceSans;herbStatusLabel.TextSize=UI.SUBTITLE_TEXT_SIZE;herbStatusLabel.TextXAlignment=Enum.TextXAlignment.Left;local herbTargetLabel=Instance.new("TextLabel");herbTargetLabel.Name="HerbTargetLabel";herbTargetLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,20);herbTargetLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,40);herbTargetLabel.BackgroundTransparency=1;herbTargetLabel.Text="当前目标: 无";herbTargetLabel.TextColor3=Color3.fromRGB(200,200,255);herbTargetLabel.Font=Enum.Font.SourceSans;herbTargetLabel.TextSize=UI.SMALL_TEXT_SIZE;herbTargetLabel.TextXAlignment=Enum.TextXAlignment.Left;local herbPriorityLabel=Instance.new("TextLabel");herbPriorityLabel.Name="HerbPriorityLabel";herbPriorityLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,20);herbPriorityLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,65);herbPriorityLabel.BackgroundTransparency=1;herbPriorityLabel.Text=(( #HerbState.priorityHerbs>0) and string.format("优先级草药: %d种", #HerbState.priorityHerbs)) or "优先级草药: 无 (采集所有草药)" ;herbPriorityLabel.TextColor3=(( #HerbState.priorityHerbs>0) and Color3.fromRGB(100,255,100)) or Color3.fromRGB(200,200,200) ;herbPriorityLabel.Font=Enum.Font.SourceSans;herbPriorityLabel.TextSize=UI.SMALL_TEXT_SIZE;herbPriorityLabel.TextXAlignment=Enum.TextXAlignment.Left;local herbFunctionLabel=Instance.new("TextLabel");herbFunctionLabel.Name="HerbFunctionLabel";herbFunctionLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);herbFunctionLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,90);herbFunctionLabel.BackgroundTransparency=1;herbFunctionLabel.Text="启动时启用功能:";herbFunctionLabel.TextColor3=Color3.fromRGB(200,200,255);herbFunctionLabel.Font=Enum.Font.SourceSansBold;herbFunctionLabel.TextSize=UI.SMALL_TEXT_SIZE;herbFunctionLabel.TextXAlignment=Enum.TextXAlignment.Left;local collisionCheckbox=Instance.new("TextButton");collisionCheckbox.Name="CollisionCheckbox";collisionCheckbox.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);collisionCheckbox.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,120);collisionCheckbox.BackgroundColor3=Color3.fromRGB(60,60,80);collisionCheckbox.Text="";collisionCheckbox.BorderSizePixel=0;local collisionCheckmark=Instance.new("TextLabel");collisionCheckmark.Name="CollisionCheckmark";collisionCheckmark.Size=UDim2.new(0,20,0,20);collisionCheckmark.Position=UDim2.new(0,5,0.5, -10);collisionCheckmark.BackgroundTransparency=1;collisionCheckmark.Text=(HerbState.collisionEnabled and "✓") or "" ;collisionCheckmark.TextColor3=Color3.fromRGB(100,255,100);collisionCheckmark.Font=Enum.Font.SourceSansBold;collisionCheckmark.TextSize=16;local collisionLabel=Instance.new("TextLabel");collisionLabel.Name="CollisionLabel";collisionLabel.Size=UDim2.new(1, -30,1,0);collisionLabel.Position=UDim2.new(0,30,0,0);collisionLabel.BackgroundTransparency=1;collisionLabel.Text="禁用地图碰撞";collisionLabel.TextColor3=Color3.fromRGB(255,255,255);collisionLabel.Font=Enum.Font.SourceSans;collisionLabel.TextSize=UI.SMALL_TEXT_SIZE;collisionLabel.TextXAlignment=Enum.TextXAlignment.Left;local quickPickCheckbox=Instance.new("TextButton");quickPickCheckbox.Name="QuickPickCheckbox";quickPickCheckbox.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);quickPickCheckbox.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,150);quickPickCheckbox.BackgroundColor3=Color3.fromRGB(60,60,80);quickPickCheckbox.Text="";quickPickCheckbox.BorderSizePixel=0;local quickPickCheckmark=Instance.new("TextLabel");quickPickCheckmark.Name="QuickPickCheckmark";quickPickCheckmark.Size=UDim2.new(0,20,0,20);quickPickCheckmark.Position=UDim2.new(0,5,0.5, -10);quickPickCheckmark.BackgroundTransparency=1;quickPickCheckmark.Text=(HerbState.quickPickEnabled and "✓") or "" ;quickPickCheckmark.TextColor3=Color3.fromRGB(100,255,100);quickPickCheckmark.Font=Enum.Font.SourceSansBold;quickPickCheckmark.TextSize=16;local quickPickLabel=Instance.new("TextLabel");quickPickLabel.Name="QuickPickLabel";quickPickLabel.Size=UDim2.new(1, -30,1,0);quickPickLabel.Position=UDim2.new(0,30,0,0);quickPickLabel.BackgroundTransparency=1;quickPickLabel.Text="一键加速";quickPickLabel.TextColor3=Color3.fromRGB(255,255,255);quickPickLabel.Font=Enum.Font.SourceSans;quickPickLabel.TextSize=UI.SMALL_TEXT_SIZE;quickPickLabel.TextXAlignment=Enum.TextXAlignment.Left;local autoHarvestCheckbox=Instance.new("TextButton");autoHarvestCheckbox.Name="AutoHarvestCheckbox";autoHarvestCheckbox.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);autoHarvestCheckbox.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,180);autoHarvestCheckbox.BackgroundColor3=Color3.fromRGB(60,60,80);autoHarvestCheckbox.Text="";autoHarvestCheckbox.BorderSizePixel=0;local autoHarvestCheckmark=Instance.new("TextLabel");autoHarvestCheckmark.Name="AutoHarvestCheckmark";autoHarvestCheckmark.Size=UDim2.new(0,20,0,20);autoHarvestCheckmark.Position=UDim2.new(0,5,0.5, -10);autoHarvestCheckmark.BackgroundTransparency=1;autoHarvestCheckmark.Text=(HerbState.autoHarvestEnabled and "✓") or "" ;autoHarvestCheckmark.TextColor3=Color3.fromRGB(100,255,100);autoHarvestCheckmark.Font=Enum.Font.SourceSansBold;autoHarvestCheckmark.TextSize=16;local autoHarvestLabel=Instance.new("TextLabel");autoHarvestLabel.Name="AutoHarvestLabel";autoHarvestLabel.Size=UDim2.new(1, -30,1,0);autoHarvestLabel.Position=UDim2.new(0,30,0,0);autoHarvestLabel.BackgroundTransparency=1;autoHarvestLabel.Text="自动采摘";autoHarvestLabel.TextColor3=Color3.fromRGB(255,255,255);autoHarvestLabel.Font=Enum.Font.SourceSans;autoHarvestLabel.TextSize=UI.SMALL_TEXT_SIZE;autoHarvestLabel.TextXAlignment=Enum.TextXAlignment.Left;local auraAutoCollectCheckbox=Instance.new("TextButton");auraAutoCollectCheckbox.Name="AuraAutoCollectCheckbox";auraAutoCollectCheckbox.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);auraAutoCollectCheckbox.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,210);auraAutoCollectCheckbox.BackgroundColor3=Color3.fromRGB(60,60,80);auraAutoCollectCheckbox.Text="";auraAutoCollectCheckbox.BorderSizePixel=0;local auraAutoCollectCheckmark=Instance.new("TextLabel");auraAutoCollectCheckmark.Name="AuraAutoCollectCheckmark";auraAutoCollectCheckmark.Size=UDim2.new(0,20,0,20);auraAutoCollectCheckmark.Position=UDim2.new(0,5,0.5, -10);auraAutoCollectCheckmark.BackgroundTransparency=1;auraAutoCollectCheckmark.Text=(HerbState.auraAutoCollectEnabled and "✓") or "" ;auraAutoCollectCheckmark.TextColor3=Color3.fromRGB(100,255,100);auraAutoCollectCheckmark.Font=Enum.Font.SourceSansBold;auraAutoCollectCheckmark.TextSize=16;local auraAutoCollectLabel=Instance.new("TextLabel");auraAutoCollectLabel.Name="AuraAutoCollectLabel";auraAutoCollectLabel.Size=UDim2.new(1, -30,1,0);auraAutoCollectLabel.Position=UDim2.new(0,30,0,0);auraAutoCollectLabel.BackgroundTransparency=1;auraAutoCollectLabel.Text="功法自动收集";auraAutoCollectLabel.TextColor3=Color3.fromRGB(255,255,255);auraAutoCollectLabel.Font=Enum.Font.SourceSans;auraAutoCollectLabel.TextSize=UI.SMALL_TEXT_SIZE;auraAutoCollectLabel.TextXAlignment=Enum.TextXAlignment.Left;local herbPriorityButton=Instance.new("TextButton");herbPriorityButton.Name="HerbPriorityButton";herbPriorityButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);herbPriorityButton.Position=UDim2.new(0.025,0,0,240);herbPriorityButton.BackgroundColor3=Color3.fromRGB(70,70,150);herbPriorityButton.Text="设置优先级";herbPriorityButton.TextColor3=Color3.fromRGB(255,255,255);herbPriorityButton.Font=Enum.Font.SourceSansBold;herbPriorityButton.TextSize=UI.BUTTON_TEXT_SIZE;herbPriorityButton.BorderSizePixel=0;local herbToggleButton=Instance.new("TextButton");herbToggleButton.Name="HerbToggleButton";herbToggleButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);herbToggleButton.Position=UDim2.new(0.525,0,0,240);herbToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);herbToggleButton.Text="启动系统";herbToggleButton.TextColor3=Color3.fromRGB(255,255,255);herbToggleButton.Font=Enum.Font.SourceSansBold;herbToggleButton.TextSize=UI.BUTTON_TEXT_SIZE;herbToggleButton.BorderSizePixel=0;local herbInfoLabel=Instance.new("TextLabel");herbInfoLabel.Name="HerbInfoLabel";herbInfoLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,100);herbInfoLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,1, -110);herbInfoLabel.BackgroundTransparency=1;herbInfoLabel.Text="提示: 自动寻找并采集草药\n支持优先级草药设置\n一键加速: 开启后秒采草药\n自动采摘: 靠近草药自动采集\n功法自动收集: 自动收集附近的功法\n禁用地图碰撞: 关闭Map文件夹中所有部件的碰撞";herbInfoLabel.TextColor3=Color3.fromRGB(180,180,255);herbInfoLabel.Font=Enum.Font.SourceSans;herbInfoLabel.TextSize=UI.SMALL_TEXT_SIZE;herbInfoLabel.TextWrapped=true;herbInfoLabel.TextXAlignment=Enum.TextXAlignment.Left;local auraStatusLabel=Instance.new("TextLabel");auraStatusLabel.Name="AuraStatusLabel";auraStatusLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);auraStatusLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,10);auraStatusLabel.BackgroundTransparency=1;auraStatusLabel.Text="功法采集: 已启用";auraStatusLabel.TextColor3=Color3.fromRGB(100,255,100);auraStatusLabel.Font=Enum.Font.SourceSans;auraStatusLabel.TextSize=UI.SUBTITLE_TEXT_SIZE;auraStatusLabel.TextXAlignment=Enum.TextXAlignment.Left;local auraTargetLabel=Instance.new("TextLabel");auraTargetLabel.Name="AuraTargetLabel";auraTargetLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,20);auraTargetLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,40);auraTargetLabel.BackgroundTransparency=1;auraTargetLabel.Text="当前功法: 无";auraTargetLabel.TextColor3=Color3.fromRGB(200,200,255);auraTargetLabel.Font=Enum.Font.SourceSans;auraTargetLabel.TextSize=UI.SMALL_TEXT_SIZE;auraTargetLabel.TextXAlignment=Enum.TextXAlignment.Left;local auraModeLabel=Instance.new("TextLabel");auraModeLabel.Name="AuraModeLabel";auraModeLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,20);auraModeLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,65);auraModeLabel.BackgroundTransparency=1;auraModeLabel.Text="目标模式: 两者优先";auraModeLabel.TextColor3=Color3.fromRGB(200,200,255);auraModeLabel.Font=Enum.Font.SourceSans;auraModeLabel.TextSize=UI.SMALL_TEXT_SIZE;auraModeLabel.TextXAlignment=Enum.TextXAlignment.Left;local auraModeButton=Instance.new("TextButton");auraModeButton.Name="AuraModeButton";auraModeButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);auraModeButton.Position=UDim2.new(0.025,0,0,90);auraModeButton.BackgroundColor3=Color3.fromRGB(150,100,70);auraModeButton.Text="切换模式";auraModeButton.TextColor3=Color3.fromRGB(255,255,255);auraModeButton.Font=Enum.Font.SourceSansBold;auraModeButton.TextSize=UI.BUTTON_TEXT_SIZE;auraModeButton.BorderSizePixel=0;local auraInfoLabel=Instance.new("TextLabel");auraInfoLabel.Name="AuraInfoLabel";auraInfoLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,80);auraInfoLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,1, -90);auraInfoLabel.BackgroundTransparency=1;auraInfoLabel.Text="提示: 功法采集系统自动寻找并采集功法\n目标模式:\n- 两者优先: 优先功法，其次草药\n- 仅功法: 只采集功法\n- 仅草药: 只采集草药\n注意: 功法自动收集功能已移至草药系统标签";auraInfoLabel.TextColor3=Color3.fromRGB(180,180,255);auraInfoLabel.Font=Enum.Font.SourceSans;auraInfoLabel.TextSize=UI.SMALL_TEXT_SIZE;auraInfoLabel.TextWrapped=true;auraInfoLabel.TextXAlignment=Enum.TextXAlignment.Left;local cultStatusLabel=Instance.new("TextLabel");cultStatusLabel.Name="CultStatusLabel";cultStatusLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);cultStatusLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,10);cultStatusLabel.BackgroundTransparency=1;cultStatusLabel.Text="修炼状态: 未修炼";cultStatusLabel.TextColor3=Color3.fromRGB(255,100,100);cultStatusLabel.Font=Enum.Font.SourceSans;cultStatusLabel.TextSize=UI.SUBTITLE_TEXT_SIZE;cultStatusLabel.TextXAlignment=Enum.TextXAlignment.Left;local cultBreakthroughLabel=Instance.new("TextLabel");cultBreakthroughLabel.Name="CultBreakthroughLabel";cultBreakthroughLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);cultBreakthroughLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,40);cultBreakthroughLabel.BackgroundTransparency=1;cultBreakthroughLabel.Text="自动突破: 关闭";cultBreakthroughLabel.TextColor3=Color3.fromRGB(255,100,100);cultBreakthroughLabel.Font=Enum.Font.SourceSans;cultBreakthroughLabel.TextSize=UI.SUBTITLE_TEXT_SIZE;cultBreakthroughLabel.TextXAlignment=Enum.TextXAlignment.Left;local cultToggleButton=Instance.new("TextButton");cultToggleButton.Name="CultToggleButton";cultToggleButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);cultToggleButton.Position=UDim2.new(0.025,0,0,75);cultToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);cultToggleButton.Text="开始修炼";cultToggleButton.TextColor3=Color3.fromRGB(255,255,255);cultToggleButton.Font=Enum.Font.SourceSansBold;cultToggleButton.TextSize=UI.BUTTON_TEXT_SIZE;cultToggleButton.BorderSizePixel=0;local cultBreakthroughButton=Instance.new("TextButton");cultBreakthroughButton.Name="CultBreakthroughButton";cultBreakthroughButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);cultBreakthroughButton.Position=UDim2.new(0.525,0,0,75);cultBreakthroughButton.BackgroundColor3=Color3.fromRGB(150,50,50);cultBreakthroughButton.Text="开启突破";cultBreakthroughButton.TextColor3=Color3.fromRGB(255,255,255);cultBreakthroughButton.Font=Enum.Font.SourceSansBold;cultBreakthroughButton.TextSize=UI.BUTTON_TEXT_SIZE;cultBreakthroughButton.BorderSizePixel=0;local cultOnceButton=Instance.new("TextButton");cultOnceButton.Name="CultOnceButton";cultOnceButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);cultOnceButton.Position=UDim2.new(0.025,0,0,120);cultOnceButton.BackgroundColor3=Color3.fromRGB(150,150,50);cultOnceButton.Text="单次突破";cultOnceButton.TextColor3=Color3.fromRGB(255,255,255);cultOnceButton.Font=Enum.Font.SourceSans;cultOnceButton.TextSize=UI.BUTTON_TEXT_SIZE;cultOnceButton.BorderSizePixel=0;local cultInfoLabel=Instance.new("TextLabel");cultInfoLabel.Name="CultInfoLabel";cultInfoLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,50);cultInfoLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,1, -60);cultInfoLabel.BackgroundTransparency=1;cultInfoLabel.Text="提示: 修炼状态可自动突破\n每隔"   .. CONFIG.BREAKTHROUGH_INTERVAL   .. "秒自动突破一次" ;cultInfoLabel.TextColor3=Color3.fromRGB(180,180,255);cultInfoLabel.Font=Enum.Font.SourceSans;cultInfoLabel.TextSize=UI.SMALL_TEXT_SIZE;cultInfoLabel.TextWrapped=true;cultInfoLabel.TextXAlignment=Enum.TextXAlignment.Left;local pillStatusLabel=Instance.new("TextLabel");pillStatusLabel.Name="PillStatusLabel";pillStatusLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,25);pillStatusLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,10);pillStatusLabel.BackgroundTransparency=1;pillStatusLabel.Text="炼药状态: 未运行";pillStatusLabel.TextColor3=Color3.fromRGB(255,100,100);pillStatusLabel.Font=Enum.Font.SourceSans;pillStatusLabel.TextSize=UI.SUBTITLE_TEXT_SIZE;pillStatusLabel.TextXAlignment=Enum.TextXAlignment.Left;local pillTypeLabel=Instance.new("TextLabel");pillTypeLabel.Name="PillTypeLabel";pillTypeLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,20);pillTypeLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,40);pillTypeLabel.BackgroundTransparency=1;pillTypeLabel.Text="当前丹药: Qi Spirit";pillTypeLabel.TextColor3=Color3.fromRGB(200,200,255);pillTypeLabel.Font=Enum.Font.SourceSans;pillTypeLabel.TextSize=UI.SMALL_TEXT_SIZE;pillTypeLabel.TextXAlignment=Enum.TextXAlignment.Left;local pillCountLabel=Instance.new("TextLabel");pillCountLabel.Name="PillCountLabel";pillCountLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,20);pillCountLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,0,65);pillCountLabel.BackgroundTransparency=1;pillCountLabel.Text="默认次数: 1";pillCountLabel.TextColor3=Color3.fromRGB(200,200,255);pillCountLabel.Font=Enum.Font.SourceSans;pillCountLabel.TextSize=UI.SMALL_TEXT_SIZE;pillCountLabel.TextXAlignment=Enum.TextXAlignment.Left;local pillSettingButton=Instance.new("TextButton");pillSettingButton.Name="PillSettingButton";pillSettingButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);pillSettingButton.Position=UDim2.new(0.025,0,0,90);pillSettingButton.BackgroundColor3=Color3.fromRGB(150,70,70);pillSettingButton.Text="炼药设置";pillSettingButton.TextColor3=Color3.fromRGB(255,255,255);pillSettingButton.Font=Enum.Font.SourceSansBold;pillSettingButton.TextSize=UI.BUTTON_TEXT_SIZE;pillSettingButton.BorderSizePixel=0;local pillToggleButton=Instance.new("TextButton");pillToggleButton.Name="PillToggleButton";pillToggleButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);pillToggleButton.Position=UDim2.new(0.525,0,0,90);pillToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);pillToggleButton.Text="开始炼药";pillToggleButton.TextColor3=Color3.fromRGB(255,255,255);pillToggleButton.Font=Enum.Font.SourceSansBold;pillToggleButton.TextSize=UI.BUTTON_TEXT_SIZE;pillToggleButton.BorderSizePixel=0;local pillOnceButton=Instance.new("TextButton");pillOnceButton.Name="PillOnceButton";pillOnceButton.Size=UDim2.new(0.45,0,0,UI.BUTTON_HEIGHT);pillOnceButton.Position=UDim2.new(0.025,0,0,135);pillOnceButton.BackgroundColor3=Color3.fromRGB(150,150,50);pillOnceButton.Text="单次炼药";pillOnceButton.TextColor3=Color3.fromRGB(255,255,255);pillOnceButton.Font=Enum.Font.SourceSans;pillOnceButton.TextSize=UI.BUTTON_TEXT_SIZE;pillOnceButton.BorderSizePixel=0;local pillInfoLabel=Instance.new("TextLabel");pillInfoLabel.Name="PillInfoLabel";pillInfoLabel.Size=UDim2.new(1, -UI.PADDING_MEDIUM * 2 ,0,60);pillInfoLabel.Position=UDim2.new(0,UI.PADDING_MEDIUM,1, -70);pillInfoLabel.BackgroundTransparency=1;pillInfoLabel.Text="提示: 使用炼药设置选择丹药类型和次数\n点击开始炼药进行批量炼制\n单次炼药只炼制一次";pillInfoLabel.TextColor3=Color3.fromRGB(180,180,255);pillInfoLabel.Font=Enum.Font.SourceSans;pillInfoLabel.TextSize=UI.SMALL_TEXT_SIZE;pillInfoLabel.TextWrapped=true;pillInfoLabel.TextXAlignment=Enum.TextXAlignment.Left;local function switchTab(tabName) CurrentTab=tabName;herbTabButton.BackgroundColor3=Color3.fromRGB(70,70,150);auraTabButton.BackgroundColor3=Color3.fromRGB(150,100,70);cultTabButton.BackgroundColor3=Color3.fromRGB(60,90,60);pillTabButton.BackgroundColor3=Color3.fromRGB(150,70,70);herbContentFrame.Visible=false;auraContentFrame.Visible=false;cultContentFrame.Visible=false;pillContentFrame.Visible=false;if (tabName=="herb") then herbTabButton.BackgroundColor3=Color3.fromRGB(90,90,170);herbContentFrame.Visible=true;elseif (tabName=="aura") then auraTabButton.BackgroundColor3=Color3.fromRGB(180,130,80);auraContentFrame.Visible=true;elseif (tabName=="cult") then cultTabButton.BackgroundColor3=Color3.fromRGB(80,120,80);cultContentFrame.Visible=true;elseif (tabName=="pill") then pillTabButton.BackgroundColor3=Color3.fromRGB(180,80,80);pillContentFrame.Visible=true;end end herbTabButton.MouseButton1Click:Connect(function() switchTab("herb");end);auraTabButton.MouseButton1Click:Connect(function() switchTab("aura");end);cultTabButton.MouseButton1Click:Connect(function() switchTab("cult");end);pillTabButton.MouseButton1Click:Connect(function() switchTab("pill");end);collisionCheckbox.MouseButton1Click:Connect(function() HerbState.collisionEnabled= not HerbState.collisionEnabled;collisionCheckmark.Text=(HerbState.collisionEnabled and "✓") or "" ;if HerbState.isRunning then if HerbState.collisionEnabled then disableAllCollisionInMap();else enableAllCollisionInMap();end end print("[系统] "   .. ((HerbState.collisionEnabled and "启用") or "禁用")   .. "碰撞禁用功能" );end);quickPickCheckbox.MouseButton1Click:Connect(function() HerbState.quickPickEnabled= not HerbState.quickPickEnabled;quickPickCheckmark.Text=(HerbState.quickPickEnabled and "✓") or "" ;if (HerbState.isRunning and HerbState.quickPickEnabled) then setupQuickPickListener();end print("[系统] "   .. ((HerbState.quickPickEnabled and "启用") or "禁用")   .. "一键加速功能" );end);autoHarvestCheckbox.MouseButton1Click:Connect(function() HerbState.autoHarvestEnabled= not HerbState.autoHarvestEnabled;autoHarvestCheckmark.Text=(HerbState.autoHarvestEnabled and "✓") or "" ;if HerbState.isRunning then if HerbState.autoHarvestEnabled then print("[自动采摘] 手动启动自动采摘");startAutoHarvest();else print("[自动采摘] 手动停止自动采摘");stopAutoHarvest();end end print("[系统] "   .. ((HerbState.autoHarvestEnabled and "启用") or "禁用")   .. "自动采摘功能" );end);auraAutoCollectCheckbox.MouseButton1Click:Connect(function() HerbState.auraAutoCollectEnabled= not HerbState.auraAutoCollectEnabled;auraAutoCollectCheckmark.Text=(HerbState.auraAutoCollectEnabled and "✓") or "" ;if HerbState.isRunning then if HerbState.auraAutoCollectEnabled then toggleAuraAutoCollect();elseif AuraAutoCollectState.enabled then toggleAuraAutoCollect();end end print("[系统] "   .. ((HerbState.auraAutoCollectEnabled and "启用") or "禁用")   .. "功法自动收集功能" );end);herbPriorityButton.MouseButton1Click:Connect(function() print("[UI] 打开优先级选择界面");createPrioritySelectionUI();end);herbToggleButton.MouseButton1Click:Connect(function() if HerbState.isPriorityUIOpen then print("[UI] 请先关闭优先级选择界面");return;end if HerbState.isRunning then stopHerbSystem();herbToggleButton.Text="启动系统";herbToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);elseif startHerbSystem() then herbToggleButton.Text="停止系统";herbToggleButton.BackgroundColor3=Color3.fromRGB(200,50,50);end end);auraModeButton.MouseButton1Click:Connect(function() if (HerbState.targetMode=="both") then HerbState.targetMode="aura";auraModeLabel.Text="目标模式: 仅功法";print("[功法] 切换为仅采集功法模式");elseif (HerbState.targetMode=="aura") then HerbState.targetMode="herb";auraModeLabel.Text="目标模式: 仅草药";print("[功法] 切换为仅采集草药模式");else HerbState.targetMode="both";auraModeLabel.Text="目标模式: 两者优先";print("[功法] 切换为两者优先模式");end end);cultToggleButton.MouseButton1Click:Connect(function() local newState=toggleCultivation();if newState then cultStatusLabel.Text="修炼状态: 修炼中";cultStatusLabel.TextColor3=Color3.fromRGB(100,255,100);cultToggleButton.Text="停止修炼";cultToggleButton.BackgroundColor3=Color3.fromRGB(200,50,50);else cultStatusLabel.Text="修炼状态: 未修炼";cultStatusLabel.TextColor3=Color3.fromRGB(255,100,100);cultToggleButton.Text="开始修炼";cultToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);if CultState.isAutoBreakthrough then stopAutoBreakthrough();end end end);cultBreakthroughButton.MouseButton1Click:Connect(function() if  not CultState.isCultivating then print("[突破] 请先开始修炼");return;end if CultState.isAutoBreakthrough then stopAutoBreakthrough();cultBreakthroughLabel.Text="自动突破: 关闭";cultBreakthroughLabel.TextColor3=Color3.fromRGB(255,100,100);cultBreakthroughButton.Text="开启突破";cultBreakthroughButton.BackgroundColor3=Color3.fromRGB(150,50,50);else startAutoBreakthrough();cultBreakthroughLabel.Text="自动突破: 开启";cultBreakthroughLabel.TextColor3=Color3.fromRGB(100,255,100);cultBreakthroughButton.Text="关闭突破";cultBreakthroughButton.BackgroundColor3=Color3.fromRGB(50,150,50);end end);cultOnceButton.MouseButton1Click:Connect(function() if  not CultState.isCultivating then print("[突破] 请先开始修炼");return;end breakthroughOnce();end);pillSettingButton.MouseButton1Click:Connect(function() print("[UI] 打开炼药设置界面");createPillUI();end);pillToggleButton.MouseButton1Click:Connect(function() if PillState.isPillUIOpen then print("[UI] 请先关闭炼药设置界面");return;end if PillState.isCrafting then stopCraftPills();pillStatusLabel.Text="炼药状态: 未运行";pillStatusLabel.TextColor3=Color3.fromRGB(255,100,100);pillToggleButton.Text="开始炼药";pillToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);elseif startCraftPills(PillState.currentPillType,PillState.craftCount) then pillStatusLabel.Text="炼药状态: 运行中";pillStatusLabel.TextColor3=Color3.fromRGB(100,255,100);pillToggleButton.Text="停止炼药";pillToggleButton.BackgroundColor3=Color3.fromRGB(200,50,50);else pillStatusLabel.Text="炼药状态: 启动失败";pillStatusLabel.TextColor3=Color3.fromRGB(255,100,100);end end);pillOnceButton.MouseButton1Click:Connect(function() if PillState.isPillUIOpen then print("[UI] 请先关闭炼药设置界面");return;end craftSinglePill(PillState.currentPillType);end);titleLabel.Parent=mainFrame;tabFrame.Parent=mainFrame;contentFrame.Parent=mainFrame;herbTabButton.Parent=tabFrame;auraTabButton.Parent=tabFrame;cultTabButton.Parent=tabFrame;pillTabButton.Parent=tabFrame;herbContentFrame.Parent=contentFrame;auraContentFrame.Parent=contentFrame;cultContentFrame.Parent=contentFrame;pillContentFrame.Parent=contentFrame;herbStatusLabel.Parent=herbContentFrame;herbTargetLabel.Parent=herbContentFrame;herbPriorityLabel.Parent=herbContentFrame;herbFunctionLabel.Parent=herbContentFrame;collisionCheckbox.Parent=herbContentFrame;collisionCheckmark.Parent=collisionCheckbox;collisionLabel.Parent=collisionCheckbox;quickPickCheckbox.Parent=herbContentFrame;quickPickCheckmark.Parent=quickPickCheckbox;quickPickLabel.Parent=quickPickCheckbox;autoHarvestCheckbox.Parent=herbContentFrame;autoHarvestCheckmark.Parent=autoHarvestCheckbox;autoHarvestLabel.Parent=autoHarvestCheckbox;auraAutoCollectCheckbox.Parent=herbContentFrame;auraAutoCollectCheckmark.Parent=auraAutoCollectCheckbox;auraAutoCollectLabel.Parent=auraAutoCollectCheckbox;herbPriorityButton.Parent=herbContentFrame;herbToggleButton.Parent=herbContentFrame;herbInfoLabel.Parent=herbContentFrame;auraStatusLabel.Parent=auraContentFrame;auraTargetLabel.Parent=auraContentFrame;auraModeLabel.Parent=auraContentFrame;auraModeButton.Parent=auraContentFrame;auraInfoLabel.Parent=auraContentFrame;cultStatusLabel.Parent=cultContentFrame;cultBreakthroughLabel.Parent=cultContentFrame;cultToggleButton.Parent=cultContentFrame;cultBreakthroughButton.Parent=cultContentFrame;cultOnceButton.Parent=cultContentFrame;cultInfoLabel.Parent=cultContentFrame;pillStatusLabel.Parent=pillContentFrame;pillTypeLabel.Parent=pillContentFrame;pillCountLabel.Parent=pillContentFrame;pillSettingButton.Parent=pillContentFrame;pillToggleButton.Parent=pillContentFrame;pillOnceButton.Parent=pillContentFrame;pillInfoLabel.Parent=pillContentFrame;mainFrame.Parent=screenGui;if MobileToggleButton then MobileToggleButton.Visible=true;MobileToggleButton.Text="隐藏界面";MobileToggleButton.MouseButton1Click:Connect(function() screenGui.Enabled= not screenGui.Enabled;MobileToggleButton.Text=(screenGui.Enabled and "隐藏界面") or "打开界面" ;if PriorityUI then PriorityUI:Destroy();PriorityUI=nil;HerbState.isPriorityUIOpen=false;end if PillUI then PillUI:Destroy();PillUI=nil;PillState.isPillUIOpen=false;end end);end screenGui.Parent=player:WaitForChild("PlayerGui");MainUI=screenGui;UIUpdateConnection=RunService.Heartbeat:Connect(function() if (screenGui and screenGui.Parent and screenGui.Enabled) then if herbStatusLabel then if HerbState.isRunning then herbStatusLabel.Text="状态: 运行中";herbStatusLabel.TextColor3=Color3.fromRGB(100,255,100);herbToggleButton.Text="停止系统";herbToggleButton.BackgroundColor3=Color3.fromRGB(200,50,50);else herbStatusLabel.Text="状态: 停止";herbStatusLabel.TextColor3=Color3.fromRGB(255,100,100);herbToggleButton.Text="启动系统";herbToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);end end if herbTargetLabel then if (HerbState.currentHerb and HerbState.currentHerb.Parent) then local age=getHerbAge(HerbState.currentHerb);local priority=getHerbPriority(HerbState.currentHerb.Name);local priorityText=(priority and string.format(" [优先级%d]",priority)) or "" ;herbTargetLabel.Text=string.format("当前目标: %s (年份: %d)%s",HerbState.currentHerb.Name,age,priorityText);herbTargetLabel.TextColor3=(priority and Color3.fromRGB(255,215,0)) or Color3.fromRGB(100,255,100) ;elseif (AuraState.currentAura and AuraState.currentAura.Parent) then herbTargetLabel.Text=string.format("当前功法: %s",AuraState.currentAura.Name);herbTargetLabel.TextColor3=Color3.fromRGB(255,215,0);else herbTargetLabel.Text="当前目标: 无";herbTargetLabel.TextColor3=Color3.fromRGB(200,200,255);end end if herbPriorityLabel then if ( #HerbState.priorityHerbs>0) then herbPriorityLabel.Text=string.format("优先级草药: %d种", #HerbState.priorityHerbs);herbPriorityLabel.TextColor3=Color3.fromRGB(100,255,100);else herbPriorityLabel.Text="优先级草药: 无 (采集所有草药)";herbPriorityLabel.TextColor3=Color3.fromRGB(200,200,200);end end if collisionCheckmark then collisionCheckmark.Text=(HerbState.collisionEnabled and "✓") or "" ;end if quickPickCheckmark then quickPickCheckmark.Text=(HerbState.quickPickEnabled and "✓") or "" ;end if autoHarvestCheckmark then autoHarvestCheckmark.Text=(HerbState.autoHarvestEnabled and "✓") or "" ;end if auraAutoCollectCheckmark then auraAutoCollectCheckmark.Text=(HerbState.auraAutoCollectEnabled and "✓") or "" ;end if auraTargetLabel then if (AuraState.currentAura and AuraState.currentAura.Parent) then auraTargetLabel.Text=string.format("当前功法: %s",AuraState.currentAura.Name);auraTargetLabel.TextColor3=Color3.fromRGB(255,215,0);else auraTargetLabel.Text="当前功法: 无";auraTargetLabel.TextColor3=Color3.fromRGB(200,200,255);end end if auraModeLabel then if (HerbState.targetMode=="both") then auraModeLabel.Text="目标模式: 两者优先";elseif (HerbState.targetMode=="aura") then auraModeLabel.Text="目标模式: 仅功法";else auraModeLabel.Text="目标模式: 仅草药";end end if cultStatusLabel then if CultState.isCultivating then cultStatusLabel.Text="修炼状态: 修炼中";cultStatusLabel.TextColor3=Color3.fromRGB(100,255,100);cultToggleButton.Text="停止修炼";cultToggleButton.BackgroundColor3=Color3.fromRGB(200,50,50);else cultStatusLabel.Text="修炼状态: 未修炼";cultStatusLabel.TextColor3=Color3.fromRGB(255,100,100);cultToggleButton.Text="开始修炼";cultToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);end end if cultBreakthroughLabel then if CultState.isAutoBreakthrough then cultBreakthroughLabel.Text="自动突破: 开启";cultBreakthroughLabel.TextColor3=Color3.fromRGB(100,255,100);cultBreakthroughButton.Text="关闭突破";cultBreakthroughButton.BackgroundColor3=Color3.fromRGB(50,150,50);else cultBreakthroughLabel.Text="自动突破: 关闭";cultBreakthroughLabel.TextColor3=Color3.fromRGB(255,100,100);cultBreakthroughButton.Text="开启突破";cultBreakthroughButton.BackgroundColor3=Color3.fromRGB(150,50,50);end end if pillStatusLabel then if PillState.isCrafting then pillStatusLabel.Text="炼药状态: 运行中";pillStatusLabel.TextColor3=Color3.fromRGB(100,255,100);pillToggleButton.Text="停止炼药";pillToggleButton.BackgroundColor3=Color3.fromRGB(200,50,50);else pillStatusLabel.Text="炼药状态: 未运行";pillStatusLabel.TextColor3=Color3.fromRGB(255,100,100);pillToggleButton.Text="开始炼药";pillToggleButton.BackgroundColor3=Color3.fromRGB(50,150,50);end end if pillTypeLabel then pillTypeLabel.Text="当前丹药: "   .. PillState.currentPillType ;end if pillCountLabel then pillCountLabel.Text="默认次数: "   .. PillState.craftCount ;end end end);return screenGui;end print("=== 多功能采集系统 ===");print("版本: 整合功能版 - 碰撞/加速/自动采摘整合到启动系统");print("主要功能:");print("1. 草药系统: 优先级草药选择 + 整合功能启动");print("2. 功法系统: 修复下降问题，优化搜索");print("3. 修炼系统: 自动突破 (间隔: "   .. CONFIG.BREAKTHROUGH_INTERVAL   .. "秒)" );print("4. 炼药系统: 独立设置界面 (支持 "   ..  #CONFIG.PILL_TYPES   .. " 种丹药)" );print("5. 整合功能: 碰撞禁用、一键加速、自动采摘、功法自动收集");task.wait(3);setupAntiAFK();loadHerbTypesFromReplicatedStorage();createMobileToggle();createMainUI();print("=== 系统初始化完成 ===");local wasHerbRunningBeforeDeath=false;local wasCollisionDisabled=false;local currentTargetMode="both";player.CharacterRemoving:Connect(function() print("[重生] 角色即将重生，记录当前状态...");wasHerbRunningBeforeDeath=HerbState.isRunning;wasCollisionDisabled=CollisionState.isCollisionDisabled;currentTargetMode=HerbState.targetMode;print("[重生] 状态记录完成:");print("- 草药系统: "   .. tostring(wasHerbRunningBeforeDeath) );print("- 碰撞禁用: "   .. tostring(wasCollisionDisabled) );print("- 目标模式: "   .. currentTargetMode );print("[重生] 防AFK系统继续运行，不停止");end);player.CharacterAdded:Connect(function(newChar) print("[重生] 角色重生，重置所有状态");character=newChar;humanoid=newChar:WaitForChild("Humanoid");humanoidRootPart=newChar:WaitForChild("HumanoidRootPart");stopHerbSystem();HerbState.currentHerb=nil;AuraState.currentAura=nil;HerbState.IsFlying=false;StopAllMovement();if CultState.isCultivating then toggleCultivation();end if CultState.isAutoBreakthrough then stopAutoBreakthrough();end if PillState.isCrafting then stopCraftPills();end task.wait(3);local mapLoaded=false;for i=1,10 do local mapFolder=Workspace:FindFirstChild("Map");if (mapFolder and ( #mapFolder:GetChildren()>0)) then mapLoaded=true;print("[重生] 地图已加载，开始重新应用碰撞禁用");break;end print("[重生] 等待地图加载... ("   .. i   .. "/10)" );task.wait(1);end if (wasCollisionDisabled and HerbState.collisionEnabled) then print("[重生] 重新应用地图碰撞禁用...");if mapLoaded then enableAllCollisionInMap();task.wait(0.5);local success=disableAllCollisionInMap();if success then print("[重生] 地图碰撞禁用重新应用成功");else print("[重生] 地图碰撞禁用重新应用失败");end else print("[重生] 警告：地图未完全加载，跳过碰撞禁用恢复");task.spawn(function() task.wait(5);local mapFolder=Workspace:FindFirstChild("Map");if mapFolder then print("[重生] 延迟恢复碰撞禁用...");enableAllCollisionInMap();task.wait(0.5);disableAllCollisionInMap();end end);end end HerbState.targetMode=currentTargetMode;if (wasHerbRunningBeforeDeath and  not HerbState.isRunning) then print("[重生] 恢复草药采集系统");startHerbSystem();end task.wait(1);if MainUI then MainUI:Destroy();MainUI=nil;end if MobileToggleGUI then MobileToggleGUI:Destroy();MobileToggleGUI=nil;end createMobileToggle();createMainUI();if AntiAFKState.IsRunning then print("[重生] 防AFK系统正在运行，保持连接");else print("[重生] 防AFK系统未运行，将在5秒后启动");task.delay(5,function() setupAntiAFK();end);end end);player.CharacterAdded:Connect(function() print("[防AFK] 角色重生，重新启动防AFK系统");task.wait(3);if  not AntiAFKState.IsRunning then setupAntiAFK();end end);print("=== 系统初始化完成 ===");
